<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4.2 Counting and correlating pairs of words with widyr | Notes for “Text Mining with R: A Tidy Approach”</title>
  <meta name="description" content="4.2 Counting and correlating pairs of words with widyr | Notes for “Text Mining with R: A Tidy Approach”" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="4.2 Counting and correlating pairs of words with widyr | Notes for “Text Mining with R: A Tidy Approach”" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="enixam/tidy-text-mining" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4.2 Counting and correlating pairs of words with widyr | Notes for “Text Mining with R: A Tidy Approach”" />
  
  
  

<meta name="author" content="Qiushi Yan" />


<meta name="date" content="2020-04-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tokenizing-by-n-gram.html"/>
<link rel="next" href="converting-to-and-from-non-tidy-formats.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.4.0/str_view.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css\style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Notes for Text Mining with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="part"><span><b>I Text Mining with R</b></span></li>
<li class="chapter" data-level="1" data-path="tidy-text-format.html"><a href="tidy-text-format.html"><i class="fa fa-check"></i><b>1</b> Tidy text format</a><ul>
<li class="chapter" data-level="1.1" data-path="the-unnest-tokens-function.html"><a href="the-unnest-tokens-function.html"><i class="fa fa-check"></i><b>1.1</b> The <code>unnest_tokens()</code> function</a></li>
<li class="chapter" data-level="1.2" data-path="the-gutenbergr-package.html"><a href="the-gutenbergr-package.html"><i class="fa fa-check"></i><b>1.2</b> The <code>gutenbergr</code> package</a></li>
<li class="chapter" data-level="1.3" data-path="compare-word-frequency.html"><a href="compare-word-frequency.html"><i class="fa fa-check"></i><b>1.3</b> Compare word frequency</a></li>
<li class="chapter" data-level="1.4" data-path="other-tokenization-methods.html"><a href="other-tokenization-methods.html"><i class="fa fa-check"></i><b>1.4</b> Other tokenization methods</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="sentiment-analysis-with-tidy-data.html"><a href="sentiment-analysis-with-tidy-data.html"><i class="fa fa-check"></i><b>2</b> Sentiment analysis with tidy data</a><ul>
<li class="chapter" data-level="2.1" data-path="the-sentiments-dataset.html"><a href="the-sentiments-dataset.html"><i class="fa fa-check"></i><b>2.1</b> The <code>sentiments</code> dataset</a></li>
<li class="chapter" data-level="2.2" data-path="sentiment-analysis-with-inner-join.html"><a href="sentiment-analysis-with-inner-join.html"><i class="fa fa-check"></i><b>2.2</b> Sentiment analysis with inner join</a></li>
<li class="chapter" data-level="2.3" data-path="comparing-3-different-dictionaries.html"><a href="comparing-3-different-dictionaries.html"><i class="fa fa-check"></i><b>2.3</b> Comparing 3 different dictionaries</a></li>
<li class="chapter" data-level="2.4" data-path="most-common-positive-and-negative-words.html"><a href="most-common-positive-and-negative-words.html"><i class="fa fa-check"></i><b>2.4</b> Most common positive and negative words</a></li>
<li class="chapter" data-level="2.5" data-path="wordclouds.html"><a href="wordclouds.html"><i class="fa fa-check"></i><b>2.5</b> Wordclouds</a></li>
<li class="chapter" data-level="2.6" data-path="units-other-than-words.html"><a href="units-other-than-words.html"><i class="fa fa-check"></i><b>2.6</b> Units other than words</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="analyzing-word-and-document-frequency.html"><a href="analyzing-word-and-document-frequency.html"><i class="fa fa-check"></i><b>3</b> Analyzing word and document frequency</a><ul>
<li class="chapter" data-level="3.1" data-path="tf-idf.html"><a href="tf-idf.html"><i class="fa fa-check"></i><b>3.1</b> tf-idf</a><ul>
<li class="chapter" data-level="3.1.1" data-path="tf-idf.html"><a href="tf-idf.html#term-frequency-in-jane-austens-novels"><i class="fa fa-check"></i><b>3.1.1</b> Term frequency in Jane Austen’s novels</a></li>
<li class="chapter" data-level="3.1.2" data-path="tf-idf.html"><a href="tf-idf.html#zipfs-law"><i class="fa fa-check"></i><b>3.1.2</b> Zipf’s law</a></li>
<li class="chapter" data-level="3.1.3" data-path="tf-idf.html"><a href="tf-idf.html#word-rank-slope-chart"><i class="fa fa-check"></i><b>3.1.3</b> Word rank slope chart</a></li>
<li class="chapter" data-level="3.1.4" data-path="tf-idf.html"><a href="tf-idf.html#the-bind_tf_idf-function"><i class="fa fa-check"></i><b>3.1.4</b> The <code>bind_tf_idf()</code> function</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="weighted-log-odds-ratio.html"><a href="weighted-log-odds-ratio.html"><i class="fa fa-check"></i><b>3.2</b> Weighted log odds ratio</a><ul>
<li class="chapter" data-level="3.2.1" data-path="weighted-log-odds-ratio.html"><a href="weighted-log-odds-ratio.html#log-odds-ratio"><i class="fa fa-check"></i><b>3.2.1</b> Log odds ratio</a></li>
<li class="chapter" data-level="3.2.2" data-path="weighted-log-odds-ratio.html"><a href="weighted-log-odds-ratio.html#model-based-approach-weighted-log-odds-ratio"><i class="fa fa-check"></i><b>3.2.2</b> Model-based approach: Weighted log odds ratio</a></li>
<li class="chapter" data-level="3.2.3" data-path="weighted-log-odds-ratio.html"><a href="weighted-log-odds-ratio.html#discussions"><i class="fa fa-check"></i><b>3.2.3</b> Discussions</a></li>
<li class="chapter" data-level="3.2.4" data-path="weighted-log-odds-ratio.html"><a href="weighted-log-odds-ratio.html#bind_log_odds"><i class="fa fa-check"></i><b>3.2.4</b> <code>bind_log_odds()</code></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="a-corpus-of-physics-texts.html"><a href="a-corpus-of-physics-texts.html"><i class="fa fa-check"></i><b>3.3</b> A corpus of physics texts</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="relationships-between-words-n-grams-and-correlations.html"><a href="relationships-between-words-n-grams-and-correlations.html"><i class="fa fa-check"></i><b>4</b> Relationships between words: n-grams and correlations</a><ul>
<li class="chapter" data-level="4.1" data-path="tokenizing-by-n-gram.html"><a href="tokenizing-by-n-gram.html"><i class="fa fa-check"></i><b>4.1</b> Tokenizing by n-gram</a><ul>
<li class="chapter" data-level="4.1.1" data-path="tokenizing-by-n-gram.html"><a href="tokenizing-by-n-gram.html#filtering-n-grams"><i class="fa fa-check"></i><b>4.1.1</b> Filtering n-grams</a></li>
<li class="chapter" data-level="4.1.2" data-path="tokenizing-by-n-gram.html"><a href="tokenizing-by-n-gram.html#analyzing-bigrams"><i class="fa fa-check"></i><b>4.1.2</b> Analyzing bigrams</a></li>
<li class="chapter" data-level="4.1.3" data-path="tokenizing-by-n-gram.html"><a href="tokenizing-by-n-gram.html#using-bigrams-to-provide-context-in-sentiment-analysis"><i class="fa fa-check"></i><b>4.1.3</b> Using bigrams to provide context in sentiment analysis</a></li>
<li class="chapter" data-level="4.1.4" data-path="tokenizing-by-n-gram.html"><a href="tokenizing-by-n-gram.html#visualizing-a-network-of-bigrams-with-ggraph"><i class="fa fa-check"></i><b>4.1.4</b> Visualizing a network of bigrams with <code>ggraph</code></a></li>
<li class="chapter" data-level="4.1.5" data-path="tokenizing-by-n-gram.html"><a href="tokenizing-by-n-gram.html#visualizing-friends"><i class="fa fa-check"></i><b>4.1.5</b> Visualizing “friends”</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="counting-and-correlating-pairs-of-words-with-widyr.html"><a href="counting-and-correlating-pairs-of-words-with-widyr.html"><i class="fa fa-check"></i><b>4.2</b> Counting and correlating pairs of words with <code>widyr</code></a><ul>
<li class="chapter" data-level="4.2.1" data-path="counting-and-correlating-pairs-of-words-with-widyr.html"><a href="counting-and-correlating-pairs-of-words-with-widyr.html#counting-and-correlating-among-sections"><i class="fa fa-check"></i><b>4.2.1</b> Counting and correlating among sections</a></li>
<li class="chapter" data-level="4.2.2" data-path="counting-and-correlating-pairs-of-words-with-widyr.html"><a href="counting-and-correlating-pairs-of-words-with-widyr.html#pairwise-correlation"><i class="fa fa-check"></i><b>4.2.2</b> Pairwise correlation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="converting-to-and-from-non-tidy-formats.html"><a href="converting-to-and-from-non-tidy-formats.html"><i class="fa fa-check"></i><b>5</b> Converting to and from non-tidy formats</a><ul>
<li class="chapter" data-level="5.1" data-path="tidying-a-document-term-matrix.html"><a href="tidying-a-document-term-matrix.html"><i class="fa fa-check"></i><b>5.1</b> Tidying a document-term matrix</a></li>
<li class="chapter" data-level="5.2" data-path="casting-tidy-text-data-into-a-matrix.html"><a href="casting-tidy-text-data-into-a-matrix.html"><i class="fa fa-check"></i><b>5.2</b> Casting tidy text data into a matrix</a></li>
<li class="chapter" data-level="5.3" data-path="tidying-corpus-objects-with-metadata.html"><a href="tidying-corpus-objects-with-metadata.html"><i class="fa fa-check"></i><b>5.3</b> Tidying corpus objects with metadata</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="topic-modeling.html"><a href="topic-modeling.html"><i class="fa fa-check"></i><b>6</b> Topic modeling</a><ul>
<li class="chapter" data-level="6.1" data-path="latent-dirichlet-allocation.html"><a href="latent-dirichlet-allocation.html"><i class="fa fa-check"></i><b>6.1</b> Latent Dirichlet Allocation</a><ul>
<li class="chapter" data-level="6.1.1" data-path="latent-dirichlet-allocation.html"><a href="latent-dirichlet-allocation.html#example-associated-press"><i class="fa fa-check"></i><b>6.1.1</b> Example: Associated Press</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="example-the-great-library-heist.html"><a href="example-the-great-library-heist.html"><i class="fa fa-check"></i><b>6.2</b> Example: the great library heist</a><ul>
<li class="chapter" data-level="6.2.1" data-path="example-the-great-library-heist.html"><a href="example-the-great-library-heist.html#lda-on-chapters"><i class="fa fa-check"></i><b>6.2.1</b> LDA on chapters</a></li>
<li class="chapter" data-level="6.2.2" data-path="example-the-great-library-heist.html"><a href="example-the-great-library-heist.html#per-document-classification"><i class="fa fa-check"></i><b>6.2.2</b> Per-document classification</a></li>
<li class="chapter" data-level="6.2.3" data-path="example-the-great-library-heist.html"><a href="example-the-great-library-heist.html#by-word-assignments-augment"><i class="fa fa-check"></i><b>6.2.3</b> By word assignments: <code>augment()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="reviews-on-regular-expressions.html"><a href="reviews-on-regular-expressions.html"><i class="fa fa-check"></i><b>A</b> Reviews on regular expressions</a><ul>
<li class="chapter" data-level="A.1" data-path="posix-character-classes.html"><a href="posix-character-classes.html"><i class="fa fa-check"></i><b>A.1</b> POSIX Character Classes</a></li>
<li class="chapter" data-level="A.2" data-path="greedy-and-lazy-quantifiers.html"><a href="greedy-and-lazy-quantifiers.html"><i class="fa fa-check"></i><b>A.2</b> Greedy and lazy quantifiers</a></li>
<li class="chapter" data-level="A.3" data-path="looking-ahead-and-back.html"><a href="looking-ahead-and-back.html"><i class="fa fa-check"></i><b>A.3</b> Looking ahead and back</a></li>
<li class="chapter" data-level="A.4" data-path="backreferences.html"><a href="backreferences.html"><i class="fa fa-check"></i><b>A.4</b> Backreferences</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="text-processing-examples-in-r.html"><a href="text-processing-examples-in-r.html"><i class="fa fa-check"></i><b>B</b> Text processing examples in R</a><ul>
<li class="chapter" data-level="B.1" data-path="replacing-and-removing.html"><a href="replacing-and-removing.html"><i class="fa fa-check"></i><b>B.1</b> Replacing and removing</a></li>
<li class="chapter" data-level="B.2" data-path="combining-and-splitting.html"><a href="combining-and-splitting.html"><i class="fa fa-check"></i><b>B.2</b> Combining and splitting</a></li>
<li class="chapter" data-level="B.3" data-path="extracting-text-from-pdf-and-other-files.html"><a href="extracting-text-from-pdf-and-other-files.html"><i class="fa fa-check"></i><b>B.3</b> Extracting text from pdf and other files</a><ul>
<li class="chapter" data-level="B.3.1" data-path="extracting-text-from-pdf-and-other-files.html"><a href="extracting-text-from-pdf-and-other-files.html#office-documents"><i class="fa fa-check"></i><b>B.3.1</b> Office documents</a></li>
<li class="chapter" data-level="B.3.2" data-path="extracting-text-from-pdf-and-other-files.html"><a href="extracting-text-from-pdf-and-other-files.html#images"><i class="fa fa-check"></i><b>B.3.2</b> Images</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Written with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Notes for “Text Mining with R: A Tidy Approach”</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="counting-and-correlating-pairs-of-words-with-widyr" class="section level2">
<h2><span class="header-section-number">4.2</span> Counting and correlating pairs of words with <code>widyr</code></h2>
<blockquote>
<p>Tokenizing by n-gram is a useful way to explore pairs of adjacent words. However, we may also be interested in words that tend to co-occur within particular documents or particular chapters, even if they don’t occur next to each other.</p>
</blockquote>
<p>For this reason, it is sometimes necessary to “cast” a tidy dataset into a wide matrix (such as a co-occurrence matrix), performs an operation such as a correlation on it, then re-tidies the result. This is when <a href="https://github.com/dgrtwo/widyr"><code>widyr</code></a> comes to the rescue, the workflow is shown in the book:</p>
<p><img src="images/widyr.jpg" width="512" style="display: block; margin: auto;" /></p>
<div id="counting-and-correlating-among-sections" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Counting and correlating among sections</h3>
<p>We devide the book “Pride and Prejudice” into 10-line sections , as we did for Section <a href="sentiment-analysis-with-inner-join.html#sentiment-analysis-with-inner-join">2.2</a> (80 lines). We may be interested in what words tend to appear within the same section.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" title="1">austen_section_words &lt;-<span class="st"> </span><span class="kw">austen_books</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb82-2" title="2"><span class="st">  </span><span class="kw">filter</span>(book <span class="op">==</span><span class="st"> &quot;Pride &amp; Prejudice&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb82-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">section =</span> <span class="kw">row_number</span>() <span class="op">%/%</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb82-4" title="4"><span class="st">  </span><span class="kw">filter</span>(section <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb82-5" title="5"><span class="st">  </span><span class="kw">unnest_tokens</span>(word, text) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb82-6" title="6"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>word <span class="op">%in%</span><span class="st"> </span>stop_words<span class="op">$</span>word)</a>
<a class="sourceLine" id="cb82-7" title="7"></a>
<a class="sourceLine" id="cb82-8" title="8">austen_section_words</a>
<a class="sourceLine" id="cb82-9" title="9"><span class="co">#&gt; # A tibble: 37,240 x 3</span></a>
<a class="sourceLine" id="cb82-10" title="10"><span class="co">#&gt;   book              section word        </span></a>
<a class="sourceLine" id="cb82-11" title="11"><span class="co">#&gt;   &lt;fct&gt;               &lt;dbl&gt; &lt;chr&gt;       </span></a>
<a class="sourceLine" id="cb82-12" title="12"><span class="co">#&gt; 1 Pride &amp; Prejudice       1 truth       </span></a>
<a class="sourceLine" id="cb82-13" title="13"><span class="co">#&gt; 2 Pride &amp; Prejudice       1 universally </span></a>
<a class="sourceLine" id="cb82-14" title="14"><span class="co">#&gt; 3 Pride &amp; Prejudice       1 acknowledged</span></a>
<a class="sourceLine" id="cb82-15" title="15"><span class="co">#&gt; 4 Pride &amp; Prejudice       1 single      </span></a>
<a class="sourceLine" id="cb82-16" title="16"><span class="co">#&gt; 5 Pride &amp; Prejudice       1 possession  </span></a>
<a class="sourceLine" id="cb82-17" title="17"><span class="co">#&gt; 6 Pride &amp; Prejudice       1 fortune     </span></a>
<a class="sourceLine" id="cb82-18" title="18"><span class="co">#&gt; # ... with 3.723e+04 more rows</span></a></code></pre></div>
<p><code>widyr::pairwise_counts()</code> counts the number of times each pair of <em>items</em> appear together within a group defined by “<em>feature</em>”. In this case, it counts the number of times each pair of words appear together within a section, note it still returns a tidy data frame, although the underlying computation took place in a matrix form :</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" title="1"><span class="kw">library</span>(widyr)</a>
<a class="sourceLine" id="cb83-2" title="2"></a>
<a class="sourceLine" id="cb83-3" title="3">austen_section_words <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb83-4" title="4"><span class="st">  </span><span class="kw">pairwise_count</span>(word, section, <span class="dt">sort =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb83-5" title="5"><span class="co">#&gt; # A tibble: 796,008 x 3</span></a>
<a class="sourceLine" id="cb83-6" title="6"><span class="co">#&gt;   item1     item2         n</span></a>
<a class="sourceLine" id="cb83-7" title="7"><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb83-8" title="8"><span class="co">#&gt; 1 darcy     elizabeth   144</span></a>
<a class="sourceLine" id="cb83-9" title="9"><span class="co">#&gt; 2 elizabeth darcy       144</span></a>
<a class="sourceLine" id="cb83-10" title="10"><span class="co">#&gt; 3 miss      elizabeth   110</span></a>
<a class="sourceLine" id="cb83-11" title="11"><span class="co">#&gt; 4 elizabeth miss        110</span></a>
<a class="sourceLine" id="cb83-12" title="12"><span class="co">#&gt; 5 elizabeth jane        106</span></a>
<a class="sourceLine" id="cb83-13" title="13"><span class="co">#&gt; 6 jane      elizabeth   106</span></a>
<a class="sourceLine" id="cb83-14" title="14"><span class="co">#&gt; # ... with 7.96e+05 more rows</span></a></code></pre></div>
<p>We can easily find the words that most often occur with Darcy. Since <code>pairwise_count</code> records both the counts of <code>(word_A, word_B)</code> and <code>(word_B, word_B)</code>, it does not matter we <code>filter</code> at <code>item1</code> or <code>item2</code></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" title="1">austen_section_words <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb84-2" title="2"><span class="st">  </span><span class="kw">pairwise_count</span>(word, section, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb84-3" title="3"><span class="st">  </span><span class="kw">filter</span>(item1 <span class="op">==</span><span class="st"> &quot;darcy&quot;</span>)</a>
<a class="sourceLine" id="cb84-4" title="4"><span class="co">#&gt; # A tibble: 2,930 x 3</span></a>
<a class="sourceLine" id="cb84-5" title="5"><span class="co">#&gt;   item1 item2         n</span></a>
<a class="sourceLine" id="cb84-6" title="6"><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb84-7" title="7"><span class="co">#&gt; 1 darcy elizabeth   144</span></a>
<a class="sourceLine" id="cb84-8" title="8"><span class="co">#&gt; 2 darcy miss         92</span></a>
<a class="sourceLine" id="cb84-9" title="9"><span class="co">#&gt; 3 darcy bingley      86</span></a>
<a class="sourceLine" id="cb84-10" title="10"><span class="co">#&gt; 4 darcy jane         46</span></a>
<a class="sourceLine" id="cb84-11" title="11"><span class="co">#&gt; 5 darcy bennet       45</span></a>
<a class="sourceLine" id="cb84-12" title="12"><span class="co">#&gt; 6 darcy sister       45</span></a>
<a class="sourceLine" id="cb84-13" title="13"><span class="co">#&gt; # ... with 2,924 more rows</span></a></code></pre></div>
</div>
<div id="pairwise-correlation" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Pairwise correlation</h3>
<blockquote>
<p>Pairs like “Elizabeth” and “Darcy” are the most common co-occurring words, but that’s not particularly meaningful since they’re also the most common individual words. We may instead want to examine correlation among words, which indicates how often they appear together relative to how often they appear separately.</p>
</blockquote>
<p>In particular, we compute the <span class="math inline">\(\phi\)</span> coefficient. Introduced by Karl Pearson, this measure is similar to the Pearson correlation coefficient in its interpretation. In fact, a Pearson correlation coefficient estimated for two binary variables will return the <span class="math inline">\(\phi\)</span> coefficient. The phi coefficient is related to the chi-squared statistic for a 2 × 2 contingency table</p>
<p><span class="math display">\[
\phi = \sqrt{\frac{\chi^2}{n}}
\]</span></p>
<p>where <span class="math inline">\(n\)</span> denotes sample size. In the case of pairwise counts, <span class="math inline">\(\phi\)</span> is calculated by</p>
<p><img src="images/phi.png" width="120%" style="display: block; margin: auto;" /></p>
<p><span class="math display">\[
\phi = \frac{n_{11}n_{00} - n_{10}n_{01}}{\sqrt{n_{1·}n_{0·}n_{·1}n_{·0}}}
\]</span></p>
<p>We see, from the above quation, that <span class="math inline">\(\phi\)</span> is “standarized” by individual counts, so various word pair with different individual frequency can be compared to each other:</p>
<p>The computation of <span class="math inline">\(\phi\)</span> can be simply done by <code>pairwise_cor</code> (other choice of correlation coefficients specified by <code>method</code>). The procedure can be somewhat computationally expensive, so we filter out uncommon words</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" title="1">word_cors &lt;-<span class="st"> </span>austen_section_words <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb85-2" title="2"><span class="st">  </span><span class="kw">add_count</span>(word) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb85-3" title="3"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;=</span><span class="st"> </span><span class="dv">20</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb85-4" title="4"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>n) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb85-5" title="5"><span class="st">  </span><span class="kw">pairwise_cor</span>(word, section, <span class="dt">sort =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb85-6" title="6"></a>
<a class="sourceLine" id="cb85-7" title="7">word_cors</a>
<a class="sourceLine" id="cb85-8" title="8"><span class="co">#&gt; # A tibble: 154,842 x 3</span></a>
<a class="sourceLine" id="cb85-9" title="9"><span class="co">#&gt;   item1    item2    correlation</span></a>
<a class="sourceLine" id="cb85-10" title="10"><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb85-11" title="11"><span class="co">#&gt; 1 bourgh   de             0.951</span></a>
<a class="sourceLine" id="cb85-12" title="12"><span class="co">#&gt; 2 de       bourgh         0.951</span></a>
<a class="sourceLine" id="cb85-13" title="13"><span class="co">#&gt; 3 pounds   thousand       0.701</span></a>
<a class="sourceLine" id="cb85-14" title="14"><span class="co">#&gt; 4 thousand pounds         0.701</span></a>
<a class="sourceLine" id="cb85-15" title="15"><span class="co">#&gt; 5 william  sir            0.664</span></a>
<a class="sourceLine" id="cb85-16" title="16"><span class="co">#&gt; 6 sir      william        0.664</span></a>
<a class="sourceLine" id="cb85-17" title="17"><span class="co">#&gt; # ... with 1.548e+05 more rows</span></a></code></pre></div>
<p>Which word is most correlated with “lady”?</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" title="1">word_cors <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb86-2" title="2"><span class="st">  </span><span class="kw">filter</span>(item1 <span class="op">==</span><span class="st"> &quot;lady&quot;</span>)</a>
<a class="sourceLine" id="cb86-3" title="3"><span class="co">#&gt; # A tibble: 393 x 3</span></a>
<a class="sourceLine" id="cb86-4" title="4"><span class="co">#&gt;   item1 item2     correlation</span></a>
<a class="sourceLine" id="cb86-5" title="5"><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;           &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb86-6" title="6"><span class="co">#&gt; 1 lady  catherine       0.663</span></a>
<a class="sourceLine" id="cb86-7" title="7"><span class="co">#&gt; 2 lady  de              0.283</span></a>
<a class="sourceLine" id="cb86-8" title="8"><span class="co">#&gt; 3 lady  bourgh          0.254</span></a>
<a class="sourceLine" id="cb86-9" title="9"><span class="co">#&gt; 4 lady  ladyship        0.227</span></a>
<a class="sourceLine" id="cb86-10" title="10"><span class="co">#&gt; 5 lady  lucas           0.198</span></a>
<a class="sourceLine" id="cb86-11" title="11"><span class="co">#&gt; 6 lady  collins         0.176</span></a>
<a class="sourceLine" id="cb86-12" title="12"><span class="co">#&gt; # ... with 387 more rows</span></a></code></pre></div>
<p>This lets us pick particular interesting words and find the other words most associated with them</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" title="1">word_cors <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-2" title="2"><span class="st">  </span><span class="kw">filter</span>(item1 <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;elizabeth&quot;</span>, <span class="st">&quot;pounds&quot;</span>, <span class="st">&quot;married&quot;</span>, <span class="st">&quot;pride&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(item1) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-4" title="4"><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">6</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-5" title="5"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-6" title="6"><span class="st">  </span><span class="kw">facet_bar</span>(<span class="dt">y =</span> item2, <span class="dt">x =</span> correlation, <span class="dt">by =</span> item1)</a></code></pre></div>
<p><img src="relationship-between-words_files/figure-html/unnamed-chunk-26-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>How about a network visualization to see the overall correlation pattern?</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" title="1">word_cors <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb88-2" title="2"><span class="st">  </span><span class="kw">filter</span>(correlation <span class="op">&gt;</span><span class="st"> </span><span class="fl">.15</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb88-3" title="3"><span class="st">  </span><span class="kw">as_tbl_graph</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb88-4" title="4"><span class="st">  </span><span class="kw">ggraph</span>(<span class="dt">layout =</span> <span class="st">&quot;fr&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb88-5" title="5"><span class="st">  </span><span class="kw">geom_edge_link</span>(<span class="kw">aes</span>(<span class="dt">edge_alpha =</span> correlation), <span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb88-6" title="6"><span class="st">  </span><span class="kw">geom_node_point</span>(<span class="dt">color =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="dt">size =</span> <span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb88-7" title="7"><span class="st">  </span><span class="kw">geom_node_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> name), <span class="dt">repel =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="relationship-between-words_files/figure-html/unnamed-chunk-27-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>Note that unlike the bigram analysis, the relationships here are <strong>symmetrical, rather than directional</strong> (there are no arrows). We can also see that while pairings of names and titles that dominated bigram pairings are common, such as “colonel/fitzwilliam”, we can also see pairings of words that appear close to each other, such as “walk” and “park”, or “dance” and “ball”.</p>

</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="tokenizing-by-n-gram.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="converting-to-and-from-non-tidy-formats.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 2
},
"edit": {
"link": "https://github.com/enixam/tidy-text-mining/edit/master/book/relationship-between-words.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
