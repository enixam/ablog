<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.6.1">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Qiushi Yan">

  
  
  
    
  
  <meta name="description" content="Hopefully this will remind myself of new features in dplyr 1.0.0">

  
  <link rel="alternate" hreflang="en-us" href="/post/taste-dplyr-1.0.0/">

  


  
  
  
  <meta name="theme-color" content="#328cc1">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Arapey:400,400i%7CKarla:400,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-165703248-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           document.location = url;
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target);  
  }

  gtag('js', new Date());
  gtag('config', 'UA-165703248-1', {});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/taste-dplyr-1.0.0/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@qiushizzzz">
  <meta property="twitter:creator" content="@qiushizzzz">
  
  <meta property="og:site_name" content="Qiushi Yan">
  <meta property="og:url" content="/post/taste-dplyr-1.0.0/">
  <meta property="og:title" content="A Taste of dplyr 1.0.0 | Qiushi Yan">
  <meta property="og:description" content="Hopefully this will remind myself of new features in dplyr 1.0.0"><meta property="og:image" content="/img/icon-192.png">
  <meta property="twitter:image" content="/img/icon-192.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-06-02T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2020-06-02T11:52:30&#43;08:00">
  

  


    






  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/taste-dplyr-1.0.0/"
  },
  "headline": "A Taste of dplyr 1.0.0",
  
  "datePublished": "2020-06-02T00:00:00Z",
  "dateModified": "2020-06-02T11:52:30+08:00",
  
  "author": {
    "@type": "Person",
    "name": "Qiushi Yan"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Qiushi Yan",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/icon-512.png"
    }
  },
  "description": "Hopefully this will remind myself of new features in dplyr 1.0.0"
}
</script>

  

  


  


  





  <title>A Taste of dplyr 1.0.0 | Qiushi Yan</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    
    
      <a class="navbar-brand" href="/">Qiushi Yan</a>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#post"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/about"><span>About / Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
      </li>
      

      

    </ul>

  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>A Taste of dplyr 1.0.0</h1>

  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    Jun 2, 2020
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    23 min read
  </span>
  

  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/r/">R</a></span>
  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style">
      

<div id="TOC">
<ul>
<li><a href="#working-within-columns">Working within columns</a></li>
<li><a href="#working-within-rows">Working within rows</a><ul>
<li><a href="#basic-usage">Basic usage</a></li>
<li><a href="#list-columns">List-columns</a></li>
<li><a href="#simulaiton">Simulaiton</a></li>
<li><a href="#group-wise-models">Group-wise models</a></li>
</ul></li>
<li><a href="#new-summarize-features">New <code>summarize</code> features</a><ul>
<li><a href="#multiple-rows-and-columns">Multiple rows and columns</a></li>
<li><a href="#use-summarize-in-non-summary-context">Use <code>summarize</code> in non-summary context</a></li>
</ul></li>
<li><a href="#move-columns-around-within-data-frames">Move columns around within data frames</a></li>
<li><a href="#row-mutation">Row mutation</a></li>
<li><a href="#superseded-functions">Superseded functions</a></li>
<li><a href="#other-changes">Other changes</a></li>
<li><a href="#use-cases">Use cases</a><ul>
<li><a href="#replace-missing-values-in-many-columns">Replace missing values in many columns</a></li>
</ul></li>
<li><a href="#references">References</a></li>
</ul>
</div>

<p>This post uses the <code>penguins</code> dataset <span class="citation">(Gorman <a href="#ref-10.1371/journal.pone.0090081" role="doc-biblioref">2014</a>)</span> for most demonstration puporses, modified by <a href="https://github.com/allisonhorst/penguins">Allison Horst</a> (as an alternative to iris).</p>
<pre class="r"><code>library(dplyr)
library(ggplot2)

packageVersion(&quot;dplyr&quot;)
#&gt; [1] &#39;1.0.0&#39;</code></pre>
<pre class="r"><code>penguins &lt;- readr::read_csv(&quot;D:/RProjects/data/blog/penguins.csv&quot;)
penguins
#&gt; # A tibble: 344 x 7
#&gt;    species island culmen_length_mm culmen_depth_mm flipper_length_~ body_mass_g
#&gt;    &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt;
#&gt;  1 Adelie  Torge~             39.1            18.7              181        3750
#&gt;  2 Adelie  Torge~             39.5            17.4              186        3800
#&gt;  3 Adelie  Torge~             40.3            18                195        3250
#&gt;  4 Adelie  Torge~             NA              NA                 NA          NA
#&gt;  5 Adelie  Torge~             36.7            19.3              193        3450
#&gt;  6 Adelie  Torge~             39.3            20.6              190        3650
#&gt;  7 Adelie  Torge~             38.9            17.8              181        3625
#&gt;  8 Adelie  Torge~             39.2            19.6              195        4675
#&gt;  9 Adelie  Torge~             34.1            18.1              193        3475
#&gt; 10 Adelie  Torge~             42              20.2              190        4250
#&gt; # ... with 334 more rows, and 1 more variable: sex &lt;chr&gt;</code></pre>
<pre class="r"><code>penguins %&gt;% 
  ggplot(aes(culmen_length_mm, culmen_depth_mm, color = species, shape = species)) + 
  geom_point()
#&gt; Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<p><img src="/post/2020-06-02-a-taste-of-dplyr-1-0-0/index.en_files/figure-html/unnamed-chunk-5-1.png" width="768" /></p>
<div id="working-within-columns" class="section level1">
<h1>Working within columns</h1>
<p>The new <code>across()</code> function supersedes functionalities of <code>_at</code>, <code>_if</code>, <code>_all</code> variants. The first argument, <code>.cols</code>, selects the columns you want to operate on. It uses tidy selection (like select()) so you can pick variables by position, name, and type. The second argument, <code>.fns</code>, is a function or list of functions to apply to each column. This can also be a purrr style formula</p>
<pre class="r"><code>penguins_grouped &lt;- penguins %&gt;% group_by(species)

penguins_grouped %&gt;% 
  summarize(across(starts_with(&quot;culmen&quot;), mean, na.rm = TRUE),
            n = n())
#&gt; # A tibble: 3 x 4
#&gt;   species   culmen_length_mm culmen_depth_mm     n
#&gt;   &lt;chr&gt;                &lt;dbl&gt;           &lt;dbl&gt; &lt;int&gt;
#&gt; 1 Adelie                38.8            18.3   152
#&gt; 2 Chinstrap             48.8            18.4    68
#&gt; 3 Gentoo                47.5            15.0   124</code></pre>
<p>For conditional selection (previous <code>_if</code> variants), predicate function should be wrapped in <code>where</code>.</p>
<pre class="r"><code># double all numeric columns
penguins %&gt;% 
  mutate(across(where(is.numeric), ~ .x * 2))
#&gt; # A tibble: 344 x 7
#&gt;    species island culmen_length_mm culmen_depth_mm flipper_length_~ body_mass_g
#&gt;    &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt;
#&gt;  1 Adelie  Torge~             78.2            37.4              362        7500
#&gt;  2 Adelie  Torge~             79              34.8              372        7600
#&gt;  3 Adelie  Torge~             80.6            36                390        6500
#&gt;  4 Adelie  Torge~             NA              NA                 NA          NA
#&gt;  5 Adelie  Torge~             73.4            38.6              386        6900
#&gt;  6 Adelie  Torge~             78.6            41.2              380        7300
#&gt;  7 Adelie  Torge~             77.8            35.6              362        7250
#&gt;  8 Adelie  Torge~             78.4            39.2              390        9350
#&gt;  9 Adelie  Torge~             68.2            36.2              386        6950
#&gt; 10 Adelie  Torge~             84              40.4              380        8500
#&gt; # ... with 334 more rows, and 1 more variable: sex &lt;chr&gt;

# count unique values of all character columns
penguins %&gt;%
  summarize(across(where(is.character), ~ length(unique(.x))))
#&gt; # A tibble: 1 x 3
#&gt;   species island   sex
#&gt;     &lt;int&gt;  &lt;int&gt; &lt;int&gt;
#&gt; 1       3      3     4</code></pre>
<p>Apply multiple functions using list and use the <code>.names</code> argument to control column names.</p>
<pre class="r"><code>penguins_grouped %&gt;% 
  summarize(across(matches(&quot;mm&quot;), 
                   list(min = ~ min(.x, na.rm = TRUE),
                        max = ~ max(.x, na.rm = TRUE)),
                   .names = &quot;{fn}_{col}&quot;))
#&gt; # A tibble: 3 x 7
#&gt;   species min_culmen_leng~ max_culmen_leng~ min_culmen_dept~ max_culmen_dept~
#&gt;   &lt;chr&gt;              &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
#&gt; 1 Adelie              32.1             46               15.5             21.5
#&gt; 2 Chinst~             40.9             58               16.4             20.8
#&gt; 3 Gentoo              40.9             59.6             13.1             17.3
#&gt; # ... with 2 more variables: min_flipper_length_mm &lt;dbl&gt;,
#&gt; #   max_flipper_length_mm &lt;dbl&gt;</code></pre>
</div>
<div id="working-within-rows" class="section level1">
<h1>Working within rows</h1>
<div id="basic-usage" class="section level2">
<h2>Basic usage</h2>
<p>Row-wise operations require a special type of grouping where each group consists of a single row. You create this with <code>rowwise()</code>.</p>
<pre class="r"><code>df &lt;- tibble(
  student_id = 1:4, 
  test1 = 10:13, 
  test2 = 20:23, 
  test3 = 30:33, 
  test4 = 40:43
)
df %&gt;% rowwise()
#&gt; # A tibble: 4 x 5
#&gt; # Rowwise: 
#&gt;   student_id test1 test2 test3 test4
#&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt; 1          1    10    20    30    40
#&gt; 2          2    11    21    31    41
#&gt; 3          3    12    22    32    42
#&gt; 4          4    13    23    33    43</code></pre>
<p><code>rowwise</code> doesn’t need any additional arguments unless you have variables that identify the rows, like <code>student_id</code> here. This can be helpful when you want to keep a row identifier.</p>
<p>Like <code>group_by</code>, <code>rowwise</code> doesn’t really do anything itself; it just changes how the other verbs work.</p>
<pre class="r"><code>df %&gt;% mutate(avg = mean(c(test1, test2, test3, test4)))
#&gt; # A tibble: 4 x 6
#&gt;   student_id test1 test2 test3 test4   avg
#&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
#&gt; 1          1    10    20    30    40  26.5
#&gt; 2          2    11    21    31    41  26.5
#&gt; 3          3    12    22    32    42  26.5
#&gt; 4          4    13    23    33    43  26.5

df %&gt;% rowwise() %&gt;% mutate(avg = mean(c(test1, test2, test3, test4)))
#&gt; # A tibble: 4 x 6
#&gt; # Rowwise: 
#&gt;   student_id test1 test2 test3 test4   avg
#&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
#&gt; 1          1    10    20    30    40    25
#&gt; 2          2    11    21    31    41    26
#&gt; 3          3    12    22    32    42    27
#&gt; 4          4    13    23    33    43    28</code></pre>
<p>In its essence, <code>rowwise</code> vectorize / parallelize a function to acheive rowwisee computation. And in this case, the <code>mean()</code> function is vectorized. If there are alternative ways of computing row-wise summaries that take advantage of built-in vectorisation then we do not need <code>rowwise</code> at all.</p>
<pre class="r"><code>df %&gt;% mutate(s = test1 + test2 + test3)
#&gt; # A tibble: 4 x 6
#&gt;   student_id test1 test2 test3 test4     s
#&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt; 1          1    10    20    30    40    60
#&gt; 2          2    11    21    31    41    63
#&gt; 3          3    12    22    32    42    66
#&gt; 4          4    13    23    33    43    69

df %&gt;% rowwise() %&gt;% mutate(s = test1 + test2 + test3)
#&gt; # A tibble: 4 x 6
#&gt; # Rowwise: 
#&gt;   student_id test1 test2 test3 test4     s
#&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt; 1          1    10    20    30    40    60
#&gt; 2          2    11    21    31    41    63
#&gt; 3          3    12    22    32    42    66
#&gt; 4          4    13    23    33    43    69</code></pre>
<p>Another family of summary functions have “parallel” extensions where you can provide multiple variables in the arguments:</p>
<pre class="r"><code>df %&gt;% 
  mutate(min = pmin(test1, test2, test3, test4),
         max = pmax(test1, test2, test3, test4),
         string = paste(test1, test2, test3, test4, sep = &quot;-&quot;))
#&gt; # A tibble: 4 x 8
#&gt;   student_id test1 test2 test3 test4   min   max string     
#&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      
#&gt; 1          1    10    20    30    40    10    40 10-20-30-40
#&gt; 2          2    11    21    31    41    11    41 11-21-31-41
#&gt; 3          3    12    22    32    42    12    42 12-22-32-42
#&gt; 4          4    13    23    33    43    13    43 13-23-33-43</code></pre>
<p>Where these functions exist, they’ll usually be faster than <code>rowwise</code>. The advantage of <code>rowwise</code> is that it works with any function, not just those that are already vectorised.</p>
<p>However, an advantage of <code>rowwise</code> even there is other ways is that it’s paired with <code>c_across()</code>, which works like <code>c()</code> but uses the same tidyselect syntax as <code>across()</code>. That makes it easy to operate on multiple variables:</p>
<pre class="r"><code>df %&gt;% 
  rowwise() %&gt;% 
  mutate(min = min(c_across(starts_with(&quot;test&quot;))),
         max = max(c_across(starts_with(&quot;test&quot;))))
#&gt; # A tibble: 4 x 7
#&gt; # Rowwise: 
#&gt;   student_id test1 test2 test3 test4   min   max
#&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt; 1          1    10    20    30    40    10    40
#&gt; 2          2    11    21    31    41    11    41
#&gt; 3          3    12    22    32    42    12    42
#&gt; 4          4    13    23    33    43    13    43</code></pre>
<p>Plus, a rowwise df will naturally contain exactly the same rows after <code>summarize()</code>, the same as <code>mutate</code></p>
<pre class="r"><code>df %&gt;% 
  rowwise() %&gt;% 
  summarize(across(starts_with(&quot;test&quot;), ~ .x, .names = &quot;{col}_same&quot;))
#&gt; # A tibble: 4 x 4
#&gt;   test1_same test2_same test3_same test4_same
#&gt;        &lt;int&gt;      &lt;int&gt;      &lt;int&gt;      &lt;int&gt;
#&gt; 1         10         20         30         40
#&gt; 2         11         21         31         41
#&gt; 3         12         22         32         42
#&gt; 4         13         23         33         43</code></pre>
</div>
<div id="list-columns" class="section level2">
<h2>List-columns</h2>
<p>Because lists can contain anything, you can use list-columns to keep related objects together, regardless of what type of thing they are. List-columns give you a convenient storage mechanism and <code>rowwise</code> gives you a convenient computation mechanism.</p>
<pre class="r"><code>df &lt;- tibble(
  x = list(1, 2:3, 4:6),
  y = list(TRUE, 1, &quot;a&quot;),
  z = list(sum, mean, sd)
)
df
#&gt; # A tibble: 3 x 3
#&gt;   x         y         z     
#&gt;   &lt;list&gt;    &lt;list&gt;    &lt;list&gt;
#&gt; 1 &lt;dbl [1]&gt; &lt;lgl [1]&gt; &lt;fn&gt;  
#&gt; 2 &lt;int [2]&gt; &lt;dbl [1]&gt; &lt;fn&gt;  
#&gt; 3 &lt;int [3]&gt; &lt;chr [1]&gt; &lt;fn&gt;</code></pre>
<pre class="r"><code>df %&gt;% 
  rowwise() %&gt;% 
  summarize(
    x_length = length(x),
    y_type = typeof(y),
    z_call = z(1:5)
  )
#&gt; # A tibble: 3 x 3
#&gt;   x_length y_type    z_call
#&gt;      &lt;int&gt; &lt;chr&gt;      &lt;dbl&gt;
#&gt; 1        1 logical    15   
#&gt; 2        2 double      3   
#&gt; 3        3 character   1.58</code></pre>
</div>
<div id="simulaiton" class="section level2">
<h2>Simulaiton</h2>
<p>The basic idea of using <code>rowwise</code> to perform simulation is to store all your simulation paramters in a data frame, similar to <code>purrr::pmap</code>.</p>
<pre class="r"><code>df &lt;- tribble(
  ~id, ~ n, ~ min, ~ max,
    1,   3,     0,     1,
    2,   2,    10,   100,
    3,   2,   100,  1000,
)</code></pre>
<p>Then you can either generate a list-column containing the simulated values with <code>mutate</code>:</p>
<pre class="r"><code>df %&gt;% 
  rowwise() %&gt;% 
  mutate(sim = list(runif(n, min, max)))
#&gt; # A tibble: 3 x 5
#&gt; # Rowwise: 
#&gt;      id     n   min   max sim      
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;   
#&gt; 1     1     3     0     1 &lt;dbl [3]&gt;
#&gt; 2     2     2    10   100 &lt;dbl [2]&gt;
#&gt; 3     3     2   100  1000 &lt;dbl [2]&gt;</code></pre>
<p>Or take advantage of <code>summarize</code>’s new features to return multiple rows per group</p>
<pre class="r"><code>df %&gt;% 
  rowwise(everything()) %&gt;% 
  summarize(sim = runif(n, min, max))
#&gt; # A tibble: 7 x 5
#&gt; # Groups:   id, n, min, max [3]
#&gt;      id     n   min   max     sim
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
#&gt; 1     1     3     0     1   0.388
#&gt; 2     1     3     0     1   0.563
#&gt; 3     1     3     0     1   0.742
#&gt; 4     2     2    10   100  92.7  
#&gt; 5     2     2    10   100  23.0  
#&gt; 6     3     2   100  1000 101.   
#&gt; 7     3     2   100  1000 705.</code></pre>
<p>The previous approach</p>
<pre class="r"><code>df %&gt;%
  mutate(sim = purrr::pmap(., ~ runif(..2, ..3, ..4)))
#&gt; # A tibble: 3 x 5
#&gt;      id     n   min   max sim      
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;   
#&gt; 1     1     3     0     1 &lt;dbl [3]&gt;
#&gt; 2     2     2    10   100 &lt;dbl [2]&gt;
#&gt; 3     3     2   100  1000 &lt;dbl [2]&gt;</code></pre>
</div>
<div id="group-wise-models" class="section level2">
<h2>Group-wise models</h2>
<p>The new <code>nest_by()</code> function works similarly to <code>group_nest()</code></p>
<pre class="r"><code>by_species &lt;- penguins %&gt;% nest_by(species)
by_species
#&gt; # A tibble: 3 x 2
#&gt; # Rowwise:  species
#&gt;   species                 data
#&gt;   &lt;chr&gt;     &lt;list&lt;tbl_df[,6]&gt;&gt;
#&gt; 1 Adelie             [152 x 6]
#&gt; 2 Chinstrap           [68 x 6]
#&gt; 3 Gentoo             [124 x 6]</code></pre>
<p>Now we can use <code>mutate</code> to fit a model to each data frame:</p>
<pre class="r"><code>by_species &lt;- by_species %&gt;% 
  rowwise(species) %&gt;% 
  mutate(model = list(lm(culmen_length_mm ~ culmen_depth_mm, data = data)))

by_species
#&gt; # A tibble: 3 x 3
#&gt; # Rowwise:  species
#&gt;   species                 data model 
#&gt;   &lt;chr&gt;     &lt;list&lt;tbl_df[,6]&gt;&gt; &lt;list&gt;
#&gt; 1 Adelie             [152 x 6] &lt;lm&gt;  
#&gt; 2 Chinstrap           [68 x 6] &lt;lm&gt;  
#&gt; 3 Gentoo             [124 x 6] &lt;lm&gt;</code></pre>
<p>And then extract model summaries or coefficients with <code>summarise()</code> and broom functions (note <code>by_species</code> is still a rowwise data frame):</p>
<pre class="r"><code>by_species %&gt;% 
  summarize(broom::glance(model))
#&gt; # A tibble: 3 x 12
#&gt; # Groups:   species [3]
#&gt;   species r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC
#&gt;   &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1 Adelie      0.153         0.148  2.46      27.0 6.67e- 7     2  -349.  704.
#&gt; 2 Chinst~     0.427         0.418  2.55      49.2 1.53e- 9     2  -159.  324.
#&gt; 3 Gentoo      0.414         0.409  2.37      85.5 1.02e-15     2  -280.  565.
#&gt; # ... with 3 more variables: BIC &lt;dbl&gt;, deviance &lt;dbl&gt;, df.residual &lt;int&gt;

by_species %&gt;% 
  summarize(broom::tidy(model))
#&gt; # A tibble: 6 x 6
#&gt; # Groups:   species [3]
#&gt;   species   term            estimate std.error statistic  p.value
#&gt;   &lt;chr&gt;     &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1 Adelie    (Intercept)       23.1       3.03       7.60 3.01e-12
#&gt; 2 Adelie    culmen_depth_mm    0.857     0.165      5.19 6.67e- 7
#&gt; 3 Chinstrap (Intercept)       13.4       5.06       2.66 9.92e- 3
#&gt; 4 Chinstrap culmen_depth_mm    1.92      0.274      7.01 1.53e- 9
#&gt; 5 Gentoo    (Intercept)       17.2       3.28       5.25 6.60e- 7
#&gt; 6 Gentoo    culmen_depth_mm    2.02      0.219      9.24 1.02e-15</code></pre>
<p>An alternative approach:</p>
<pre class="r"><code>penguins %&gt;%
  group_by(species) %&gt;% 
  group_modify(~ broom::tidy(lm(culmen_length_mm ~ culmen_depth_mm, data = .x)))
#&gt; # A tibble: 6 x 6
#&gt; # Groups:   species [3]
#&gt;   species   term            estimate std.error statistic  p.value
#&gt;   &lt;chr&gt;     &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1 Adelie    (Intercept)       23.1       3.03       7.60 3.01e-12
#&gt; 2 Adelie    culmen_depth_mm    0.857     0.165      5.19 6.67e- 7
#&gt; 3 Chinstrap (Intercept)       13.4       5.06       2.66 9.92e- 3
#&gt; 4 Chinstrap culmen_depth_mm    1.92      0.274      7.01 1.53e- 9
#&gt; 5 Gentoo    (Intercept)       17.2       3.28       5.25 6.60e- 7
#&gt; 6 Gentoo    culmen_depth_mm    2.02      0.219      9.24 1.02e-15</code></pre>
</div>
</div>
<div id="new-summarize-features" class="section level1">
<h1>New <code>summarize</code> features</h1>
<div id="multiple-rows-and-columns" class="section level2">
<h2>Multiple rows and columns</h2>
<p>Two big changes make <code>summarize()</code> much more flexible. A single summary expression can now return:</p>
<ul>
<li><p>A vector of any length, creating multiple rows. (so we can use summary that returns multiple values without <code>list</code>)</p></li>
<li><p>A data frame, creating multiple columns.</p></li>
</ul>
<pre class="r"><code>penguins_grouped %&gt;%
  summarize(culmen_length_dist = quantile(culmen_length_mm, 
                                          c(0.25, 0.5, 0.75),
                                          na.rm = TRUE), 
            q = c(0.25, 0.5, 0.75))
#&gt; # A tibble: 9 x 3
#&gt; # Groups:   species [3]
#&gt;   species   culmen_length_dist     q
#&gt;   &lt;chr&gt;                  &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1 Adelie                  36.8  0.25
#&gt; 2 Adelie                  38.8  0.5 
#&gt; 3 Adelie                  40.8  0.75
#&gt; 4 Chinstrap               46.3  0.25
#&gt; 5 Chinstrap               49.6  0.5 
#&gt; 6 Chinstrap               51.1  0.75
#&gt; 7 Gentoo                  45.3  0.25
#&gt; 8 Gentoo                  47.3  0.5 
#&gt; 9 Gentoo                  49.6  0.75</code></pre>
<p>Or return multiple columns from a single summary expression:</p>
<pre class="r"><code>penguins_grouped %&gt;% 
  summarize(tibble(min = min(culmen_depth_mm, na.rm = TRUE),
                   max = max(culmen_depth_mm, na.rm = TRUE)))
#&gt; # A tibble: 3 x 3
#&gt;   species     min   max
#&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1 Adelie     15.5  21.5
#&gt; 2 Chinstrap  16.4  20.8
#&gt; 3 Gentoo     13.1  17.3</code></pre>
<p>At the first glance this may seem not so different with supplying multiple name-value pairs. But this can be useful inside functions. For example, in the previous <code>quantile</code> code it would be nice to be able to reduce the duplication so that we don’t have to type the quantile values twice. We can now write a simple function because summary expressions can now be data frames or tibbles:</p>
<pre class="r"><code>quibble &lt;- function(x, q = c(0.25, 0.5, 0.75), na.rm = TRUE) {
  tibble(x = quantile(x, q, na.rm = na.rm), q = q)
}

penguins_grouped %&gt;% 
  summarize(quibble(culmen_depth_mm))
#&gt; # A tibble: 9 x 3
#&gt; # Groups:   species [3]
#&gt;   species       x     q
#&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1 Adelie     17.5  0.25
#&gt; 2 Adelie     18.4  0.5 
#&gt; 3 Adelie     19    0.75
#&gt; 4 Chinstrap  17.5  0.25
#&gt; 5 Chinstrap  18.4  0.5 
#&gt; 6 Chinstrap  19.4  0.75
#&gt; 7 Gentoo     14.2  0.25
#&gt; 8 Gentoo     15    0.5 
#&gt; 9 Gentoo     15.7  0.75</code></pre>
<p>When combining glue syntax and tidy evaluation, it is easy to dynamically name the column names.</p>
<pre class="r"><code>quibble &lt;- function(x, q = c(0.25, 0.5, 0.75), na.rm = TRUE) {
  tibble(&quot;{{ x }}_quantile&quot; := quantile(x, q, na.rm = na.rm), 
         &quot;{{ x }}_q&quot; := q)
}

penguins_grouped %&gt;% 
  summarize(quibble(flipper_length_mm))
#&gt; # A tibble: 9 x 3
#&gt; # Groups:   species [3]
#&gt;   species   flipper_length_mm_quantile flipper_length_mm_q
#&gt;   &lt;chr&gt;                          &lt;dbl&gt;               &lt;dbl&gt;
#&gt; 1 Adelie                           186                0.25
#&gt; 2 Adelie                           190                0.5 
#&gt; 3 Adelie                           195                0.75
#&gt; 4 Chinstrap                        191                0.25
#&gt; 5 Chinstrap                        196                0.5 
#&gt; 6 Chinstrap                        201                0.75
#&gt; 7 Gentoo                           212                0.25
#&gt; 8 Gentoo                           216                0.5 
#&gt; 9 Gentoo                           221                0.75</code></pre>
<p>As an aside, if we name the tibble expression in <code>summarize()</code> that part will be packed in the result, which can be solved by <code>tidyr::unpack</code>. That’s because when we leave the name off, the data frame result is automatically unpacked.</p>
<pre class="r"><code>penguins_grouped %&gt;% 
  summarize(df = quibble(flipper_length_mm))
#&gt; # A tibble: 9 x 2
#&gt; # Groups:   species [3]
#&gt;   species   df$flipper_length_mm_quantile $flipper_length_mm_q
#&gt;   &lt;chr&gt;                             &lt;dbl&gt;                &lt;dbl&gt;
#&gt; 1 Adelie                              186                 0.25
#&gt; 2 Adelie                              190                 0.5 
#&gt; 3 Adelie                              195                 0.75
#&gt; 4 Chinstrap                           191                 0.25
#&gt; 5 Chinstrap                           196                 0.5 
#&gt; 6 Chinstrap                           201                 0.75
#&gt; 7 Gentoo                              212                 0.25
#&gt; 8 Gentoo                              216                 0.5 
#&gt; 9 Gentoo                              221                 0.75</code></pre>
</div>
<div id="use-summarize-in-non-summary-context" class="section level2">
<h2>Use <code>summarize</code> in non-summary context</h2>
<p>In combination with rowwise operations, <code>summarize()</code> is now sufficiently powerful to replace many workflows that previously required a <code>map()</code> function.</p>
<p>For example, to read all the all the .csv files in the current directory, you could write:</p>
<pre class="r"><code>tibble(path = dir(pattern = &quot;\\.csv$&quot;)) %&gt;% 
  rowwise(path) %&gt;% 
  summarize(read_csv(path))</code></pre>
</div>
</div>
<div id="move-columns-around-within-data-frames" class="section level1">
<h1>Move columns around within data frames</h1>
<p>New verb <code>relocate</code> is provided to change column positions with the same syntax as <code>select</code>. The default behaviour is to move selected columns to the left-hand side</p>
<pre class="r"><code>penguins %&gt;% relocate(island)
#&gt; # A tibble: 344 x 7
#&gt;    island species culmen_length_mm culmen_depth_mm flipper_length_~ body_mass_g
#&gt;    &lt;chr&gt;  &lt;chr&gt;              &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt;
#&gt;  1 Torge~ Adelie              39.1            18.7              181        3750
#&gt;  2 Torge~ Adelie              39.5            17.4              186        3800
#&gt;  3 Torge~ Adelie              40.3            18                195        3250
#&gt;  4 Torge~ Adelie              NA              NA                 NA          NA
#&gt;  5 Torge~ Adelie              36.7            19.3              193        3450
#&gt;  6 Torge~ Adelie              39.3            20.6              190        3650
#&gt;  7 Torge~ Adelie              38.9            17.8              181        3625
#&gt;  8 Torge~ Adelie              39.2            19.6              195        4675
#&gt;  9 Torge~ Adelie              34.1            18.1              193        3475
#&gt; 10 Torge~ Adelie              42              20.2              190        4250
#&gt; # ... with 334 more rows, and 1 more variable: sex &lt;chr&gt;

penguins %&gt;% relocate(starts_with(&quot;culmen&quot;))
#&gt; # A tibble: 344 x 7
#&gt;    culmen_length_mm culmen_depth_mm species island flipper_length_~ body_mass_g
#&gt;               &lt;dbl&gt;           &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;       &lt;dbl&gt;
#&gt;  1             39.1            18.7 Adelie  Torge~              181        3750
#&gt;  2             39.5            17.4 Adelie  Torge~              186        3800
#&gt;  3             40.3            18   Adelie  Torge~              195        3250
#&gt;  4             NA              NA   Adelie  Torge~               NA          NA
#&gt;  5             36.7            19.3 Adelie  Torge~              193        3450
#&gt;  6             39.3            20.6 Adelie  Torge~              190        3650
#&gt;  7             38.9            17.8 Adelie  Torge~              181        3625
#&gt;  8             39.2            19.6 Adelie  Torge~              195        4675
#&gt;  9             34.1            18.1 Adelie  Torge~              193        3475
#&gt; 10             42              20.2 Adelie  Torge~              190        4250
#&gt; # ... with 334 more rows, and 1 more variable: sex &lt;chr&gt;

penguins %&gt;% relocate(sex, body_mass_g, .after = species)
#&gt; # A tibble: 344 x 7
#&gt;    species sex   body_mass_g island culmen_length_mm culmen_depth_mm
#&gt;    &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;           &lt;dbl&gt;
#&gt;  1 Adelie  MALE         3750 Torge~             39.1            18.7
#&gt;  2 Adelie  FEMA~        3800 Torge~             39.5            17.4
#&gt;  3 Adelie  FEMA~        3250 Torge~             40.3            18  
#&gt;  4 Adelie  &lt;NA&gt;           NA Torge~             NA              NA  
#&gt;  5 Adelie  FEMA~        3450 Torge~             36.7            19.3
#&gt;  6 Adelie  MALE         3650 Torge~             39.3            20.6
#&gt;  7 Adelie  FEMA~        3625 Torge~             38.9            17.8
#&gt;  8 Adelie  MALE         4675 Torge~             39.2            19.6
#&gt;  9 Adelie  &lt;NA&gt;         3475 Torge~             34.1            18.1
#&gt; 10 Adelie  &lt;NA&gt;         4250 Torge~             42              20.2
#&gt; # ... with 334 more rows, and 1 more variable: flipper_length_mm &lt;dbl&gt;</code></pre>
<p>Similarly, <code>mutate</code> gains new arguments <code>.after</code> and <code>.before</code> to control where new columns should appear.</p>
<pre class="r"><code>penguins %&gt;% 
  mutate(mass_double = body_mass_g * 2, .before = 1)
#&gt; # A tibble: 344 x 8
#&gt;    mass_double species island culmen_length_mm culmen_depth_mm flipper_length_~
#&gt;          &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;
#&gt;  1        7500 Adelie  Torge~             39.1            18.7              181
#&gt;  2        7600 Adelie  Torge~             39.5            17.4              186
#&gt;  3        6500 Adelie  Torge~             40.3            18                195
#&gt;  4          NA Adelie  Torge~             NA              NA                 NA
#&gt;  5        6900 Adelie  Torge~             36.7            19.3              193
#&gt;  6        7300 Adelie  Torge~             39.3            20.6              190
#&gt;  7        7250 Adelie  Torge~             38.9            17.8              181
#&gt;  8        9350 Adelie  Torge~             39.2            19.6              195
#&gt;  9        6950 Adelie  Torge~             34.1            18.1              193
#&gt; 10        8500 Adelie  Torge~             42              20.2              190
#&gt; # ... with 334 more rows, and 2 more variables: body_mass_g &lt;dbl&gt;, sex &lt;chr&gt;</code></pre>
</div>
<div id="row-mutation" class="section level1">
<h1>Row mutation</h1>
<p>dplyr has a new experimental family of row mutation functions inspired by SQL’s <code>UPDATE</code>, <code>INSERT</code>, <code>UPSERT</code>, and <code>DELETE</code>. Like the join functions, they all work with a pair of data frames:</p>
<ul>
<li><p><code>rows_update(x, y)</code> updates existing rows in x with values in y.</p></li>
<li><p><code>rows_patch(x, y)</code> works like rows_update() but only changes <code>NA</code> values.</p></li>
<li><p><code>rows_insert(x, y)</code> adds new rows to x from y.</p></li>
<li><p><code>rows_upsert(x, y)</code> updates existing rows in x and adds new rows from y.</p></li>
<li><p><code>rows_delete(x, y)</code> deletes rows in x that match rows in y.</p></li>
</ul>
<p>The <code>rows_</code> functions match x and y using <strong>keys</strong>. All of them check that the keys of x and y are valid (i.e. unique) before doing anything.</p>
<pre class="r"><code>df &lt;- tibble(a = 1:3, b = letters[c(1:2, NA)], c = 0.5 + 0:2)
df
#&gt; # A tibble: 3 x 3
#&gt;       a b         c
#&gt;   &lt;int&gt; &lt;chr&gt; &lt;dbl&gt;
#&gt; 1     1 a       0.5
#&gt; 2     2 b       1.5
#&gt; 3     3 &lt;NA&gt;    2.5</code></pre>
<p>We can use <code>rows_insert()</code> to add new rows:</p>
<pre class="r"><code>new &lt;- tibble(a = c(4, 5), b = c(&quot;d&quot;, &quot;e&quot;), c = c(3.5, 4.5))

rows_insert(df, new)
#&gt; # A tibble: 5 x 3
#&gt;       a b         c
#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
#&gt; 1     1 a       0.5
#&gt; 2     2 b       1.5
#&gt; 3     3 &lt;NA&gt;    2.5
#&gt; 4     4 d       3.5
#&gt; 5     5 e       4.5</code></pre>
<p>Note that <code>rows_insert()</code> will fail if we attempt to insert a row that already exists:</p>
<pre class="r"><code>df %&gt;% rows_insert(tibble(a = 3, b = &quot;c&quot;))
#&gt; Error: Attempting to insert duplicate rows.

df %&gt;% rows_insert(tibble(a = 3, b = &quot;c&quot;), by = c(&quot;a&quot;, &quot;b&quot;))
#&gt; # A tibble: 4 x 3
#&gt;       a b         c
#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
#&gt; 1     1 a       0.5
#&gt; 2     2 b       1.5
#&gt; 3     3 &lt;NA&gt;    2.5
#&gt; 4     3 c      NA</code></pre>
<p>If you want to update existing values, use <code>rows_update()</code>. As you might expect, it’ll error if one of the rows to update doesn’t exist:</p>
<pre class="r"><code>df %&gt;% rows_update(tibble(a = 3, b = &quot;c&quot;))
#&gt; # A tibble: 3 x 3
#&gt;       a b         c
#&gt;   &lt;int&gt; &lt;chr&gt; &lt;dbl&gt;
#&gt; 1     1 a       0.5
#&gt; 2     2 b       1.5
#&gt; 3     3 c       2.5

df %&gt;% rows_update(tibble(a = 4, b = &quot;d&quot;))
#&gt; Error: Attempting to update missing rows.</code></pre>
<p><code>rows_patch()</code> is a variant of <code>rows_update()</code> that will only update values in x that are <code>NA</code>.</p>
<pre class="r"><code>df %&gt;% rows_patch(tibble(a = 1:3, b = &quot;patch&quot;))
#&gt; # A tibble: 3 x 3
#&gt;       a b         c
#&gt;   &lt;int&gt; &lt;chr&gt; &lt;dbl&gt;
#&gt; 1     1 a       0.5
#&gt; 2     2 b       1.5
#&gt; 3     3 patch   2.5</code></pre>
<p><code>row_upsert</code> update a df or insert new rows.</p>
<pre class="r"><code>df %&gt;% 
  rows_upsert(tibble(a = 3, b = &quot;c&quot;)) %&gt;%  # update
  rows_upsert(tibble(a = 4, b = &quot;d&quot;)) # insert
#&gt; # A tibble: 4 x 3
#&gt;       a b         c
#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
#&gt; 1     1 a       0.5
#&gt; 2     2 b       1.5
#&gt; 3     3 c       2.5
#&gt; 4     4 d      NA</code></pre>
</div>
<div id="superseded-functions" class="section level1">
<h1>Superseded functions</h1>
<p><code>top_n()</code>, <code>sample_n()</code>, and <code>sample_frac()</code> have been superseded in favour of a new family of slice helpers: <code>slice_min()</code>, <code>slice_max()</code>, <code>slice_head()</code>, <code>slice_tail()</code>, <code>slice_random()</code>.</p>
<pre class="r"><code># select penguins per group on body mass
penguins_grouped %&gt;% 
  slice_max(body_mass_g, 1)
#&gt; # A tibble: 3 x 7
#&gt; # Groups:   species [3]
#&gt;   species island culmen_length_mm culmen_depth_mm flipper_length_~ body_mass_g
#&gt;   &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt;
#&gt; 1 Adelie  Biscoe             43.2            19                197        4775
#&gt; 2 Chinst~ Dream              52              20.7              210        4800
#&gt; 3 Gentoo  Biscoe             49.2            15.2              221        6300
#&gt; # ... with 1 more variable: sex &lt;chr&gt;

penguins_grouped %&gt;% 
  slice_min(body_mass_g, 1)
#&gt; # A tibble: 4 x 7
#&gt; # Groups:   species [3]
#&gt;   species island culmen_length_mm culmen_depth_mm flipper_length_~ body_mass_g
#&gt;   &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt;
#&gt; 1 Adelie  Biscoe             36.5            16.6              181        2850
#&gt; 2 Adelie  Biscoe             36.4            17.1              184        2850
#&gt; 3 Chinst~ Dream              46.9            16.6              192        2700
#&gt; 4 Gentoo  Biscoe             42.7            13.7              208        3950
#&gt; # ... with 1 more variable: sex &lt;chr&gt;</code></pre>
<pre class="r"><code># random sampling
penguins %&gt;% 
  slice_sample(n = 10)
#&gt; # A tibble: 10 x 7
#&gt;    species island culmen_length_mm culmen_depth_mm flipper_length_~ body_mass_g
#&gt;    &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt;
#&gt;  1 Chinst~ Dream              46.9            16.6              192        2700
#&gt;  2 Adelie  Biscoe             41.4            18.6              191        3700
#&gt;  3 Adelie  Biscoe             39              17.5              186        3550
#&gt;  4 Adelie  Dream              44.1            19.7              196        4400
#&gt;  5 Gentoo  Biscoe             46.8            16.1              215        5500
#&gt;  6 Gentoo  Biscoe             44.5            14.3              216        4100
#&gt;  7 Adelie  Biscoe             41.1            19.1              188        4100
#&gt;  8 Chinst~ Dream              50.2            18.8              202        3800
#&gt;  9 Adelie  Torge~             39.6            17.2              196        3550
#&gt; 10 Chinst~ Dream              55.8            19.8              207        4000
#&gt; # ... with 1 more variable: sex &lt;chr&gt;

penguins %&gt;% 
  slice_sample(prop = 0.1)
#&gt; # A tibble: 34 x 7
#&gt;    species island culmen_length_mm culmen_depth_mm flipper_length_~ body_mass_g
#&gt;    &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt;
#&gt;  1 Adelie  Dream              39.6            18.8              190        4600
#&gt;  2 Chinst~ Dream              53.5            19.9              205        4500
#&gt;  3 Chinst~ Dream              49.8            17.3              198        3675
#&gt;  4 Adelie  Dream              37.6            19.3              181        3300
#&gt;  5 Adelie  Biscoe             38.2            18.1              185        3950
#&gt;  6 Gentoo  Biscoe             52.2            17.1              228        5400
#&gt;  7 Gentoo  Biscoe             42.6            13.7              213        4950
#&gt;  8 Adelie  Dream              39              18.7              185        3650
#&gt;  9 Adelie  Torge~             40.2            17                176        3450
#&gt; 10 Gentoo  Biscoe             46.2            14.9              221        5300
#&gt; # ... with 24 more rows, and 1 more variable: sex &lt;chr&gt;</code></pre>
<p><code>summarize()</code> gains new argument <code>.groups</code> to control grouping structure of theh result.</p>
<ul>
<li><p><code>.groups = "drop_last"</code> drops the last grouping level (i.e. the default behaviour).</p></li>
<li><p><code>.groups = "drop"</code> drops all grouping levels and returns a tibble.</p></li>
<li><p><code>.groups = "keep"</code> preserves the grouping of the input.</p></li>
<li><p><code>.groups = "rowwise"</code> turns each row into its own group.</p></li>
</ul>
</div>
<div id="other-changes" class="section level1">
<h1>Other changes</h1>
<p>The new <code>rename_with()</code> makes it easier to rename variables programmatically:</p>
<pre class="r"><code>penguins %&gt;%
  rename_with(stringr::str_to_upper)
#&gt; # A tibble: 344 x 7
#&gt;    SPECIES ISLAND CULMEN_LENGTH_MM CULMEN_DEPTH_MM FLIPPER_LENGTH_~ BODY_MASS_G
#&gt;    &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt;
#&gt;  1 Adelie  Torge~             39.1            18.7              181        3750
#&gt;  2 Adelie  Torge~             39.5            17.4              186        3800
#&gt;  3 Adelie  Torge~             40.3            18                195        3250
#&gt;  4 Adelie  Torge~             NA              NA                 NA          NA
#&gt;  5 Adelie  Torge~             36.7            19.3              193        3450
#&gt;  6 Adelie  Torge~             39.3            20.6              190        3650
#&gt;  7 Adelie  Torge~             38.9            17.8              181        3625
#&gt;  8 Adelie  Torge~             39.2            19.6              195        4675
#&gt;  9 Adelie  Torge~             34.1            18.1              193        3475
#&gt; 10 Adelie  Torge~             42              20.2              190        4250
#&gt; # ... with 334 more rows, and 1 more variable: SEX &lt;chr&gt;</code></pre>
<p>You can optionally choose which columns to apply the transformation to with the second argument:</p>
<pre class="r"><code>penguins %&gt;%
  rename_with(stringr::str_to_upper, starts_with(&quot;culmen&quot;))
#&gt; # A tibble: 344 x 7
#&gt;    species island CULMEN_LENGTH_MM CULMEN_DEPTH_MM flipper_length_~ body_mass_g
#&gt;    &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt;
#&gt;  1 Adelie  Torge~             39.1            18.7              181        3750
#&gt;  2 Adelie  Torge~             39.5            17.4              186        3800
#&gt;  3 Adelie  Torge~             40.3            18                195        3250
#&gt;  4 Adelie  Torge~             NA              NA                 NA          NA
#&gt;  5 Adelie  Torge~             36.7            19.3              193        3450
#&gt;  6 Adelie  Torge~             39.3            20.6              190        3650
#&gt;  7 Adelie  Torge~             38.9            17.8              181        3625
#&gt;  8 Adelie  Torge~             39.2            19.6              195        4675
#&gt;  9 Adelie  Torge~             34.1            18.1              193        3475
#&gt; 10 Adelie  Torge~             42              20.2              190        4250
#&gt; # ... with 334 more rows, and 1 more variable: sex &lt;chr&gt;</code></pre>
<p><code>mutate()</code> gains argument <code>.keep</code> that allows you to control which columns are retained in the output:</p>
<pre class="r"><code>penguins %&gt;% mutate(double_mass = body_mass_g * 2,
                    island_lower = stringr::str_to_lower(island), 
                    .keep = &quot;used&quot;)
#&gt; # A tibble: 344 x 4
#&gt;    island    body_mass_g double_mass island_lower
#&gt;    &lt;chr&gt;           &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;       
#&gt;  1 Torgersen        3750        7500 torgersen   
#&gt;  2 Torgersen        3800        7600 torgersen   
#&gt;  3 Torgersen        3250        6500 torgersen   
#&gt;  4 Torgersen          NA          NA torgersen   
#&gt;  5 Torgersen        3450        6900 torgersen   
#&gt;  6 Torgersen        3650        7300 torgersen   
#&gt;  7 Torgersen        3625        7250 torgersen   
#&gt;  8 Torgersen        4675        9350 torgersen   
#&gt;  9 Torgersen        3475        6950 torgersen   
#&gt; 10 Torgersen        4250        8500 torgersen   
#&gt; # ... with 334 more rows

penguins %&gt;% mutate(double_mass = body_mass_g * 2, .keep = &quot;none&quot;)
#&gt; # A tibble: 344 x 1
#&gt;    double_mass
#&gt;          &lt;dbl&gt;
#&gt;  1        7500
#&gt;  2        7600
#&gt;  3        6500
#&gt;  4          NA
#&gt;  5        6900
#&gt;  6        7300
#&gt;  7        7250
#&gt;  8        9350
#&gt;  9        6950
#&gt; 10        8500
#&gt; # ... with 334 more rows</code></pre>
</div>
<div id="use-cases" class="section level1">
<h1>Use cases</h1>
<p>This in-progress section documents tasks that would otherwise been impossible or laborious with previous version of dplyr.</p>
<div id="replace-missing-values-in-many-columns" class="section level2">
<h2>Replace missing values in many columns</h2>
<p>Since <code>tidyr::replace_na</code> does not support tidy select syntax, replacing NA values in multiple columns could be a drudgery. Now this is made easy with <code>coalesce</code> and <code>across</code></p>
<pre class="r"><code>penguins %&gt;% summarize(across(starts_with(&quot;culmen&quot;), ~ sum(is.na(.x))))
#&gt; # A tibble: 1 x 2
#&gt;   culmen_length_mm culmen_depth_mm
#&gt;              &lt;int&gt;           &lt;int&gt;
#&gt; 1                2               2

penguins %&gt;% 
  mutate(across(starts_with(&quot;culmen&quot;), ~ coalesce(.x, 0))) %&gt;% 
  summarize(across(starts_with(&quot;culmen&quot;), ~ sum(is.na(.x))))
#&gt; # A tibble: 1 x 2
#&gt;   culmen_length_mm culmen_depth_mm
#&gt;              &lt;int&gt;           &lt;int&gt;
#&gt; 1                0               0</code></pre>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-10.1371/journal.pone.0090081">
<p>Gorman, Tony D. AND Fraser, Kristen B. AND Williams. 2014. “Ecological Sexual Dimorphism and Environmental Variability Within a Community of Antarctic Penguins (Genus Pygoscelis).” <em>PLOS ONE</em> 9 (3): 1–14. <a href="https://doi.org/10.1371/journal.pone.0090081">https://doi.org/10.1371/journal.pone.0090081</a>.</p>
</div>
</div>
</div>

    </div>

    







<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/taste-dplyr-1.0.0/&amp;text=A%20Taste%20of%20dplyr%201.0.0" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/taste-dplyr-1.0.0/&amp;t=A%20Taste%20of%20dplyr%201.0.0" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=A%20Taste%20of%20dplyr%201.0.0&amp;body=/post/taste-dplyr-1.0.0/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/taste-dplyr-1.0.0/&amp;title=A%20Taste%20of%20dplyr%201.0.0" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=A%20Taste%20of%20dplyr%201.0.0%20/post/taste-dplyr-1.0.0/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/taste-dplyr-1.0.0/&amp;title=A%20Taste%20of%20dplyr%201.0.0" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  






  
  
  
    
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="portrait mr-3" src="/authors/qiushi/avatar_hu2833603c9957d65d4c6e6cf5762ee973_72134_250x250_fill_q90_lanczos_center.jpg" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Qiushi Yan</a></h5>
      <h6 class="card-subtitle">Junior student, Data Journalism</h6>
      <p class="card-text">Yet another object of type closure</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/enixam" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/qiushizzzz" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/%E6%B1%82%E8%AF%86-%E9%97%AB-893a48194/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/about" >
        <i class="fas fa-address-card"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>




<section id="comments">
  
    
<div id="disqus_thread"></div>
<script>
  let disqus_config = function () {
    
    
    
  };
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
      return;
    }
    var d = document, s = d.createElement('script'); s.async = true;
    s.src = 'https://' + "qiushiyan" + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  
</section>




<div class="article-widget">
  
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/post/2020-05-21-excess-death-for-2020/" rel="prev">Excess Death for 2020</a>
  </div>
  
</div>

</div>



  
  



  </div>
</article>

      

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.3.1/mermaid.min.js" integrity="sha256-vOIuDSYDirTfyr+S2MjFnhOz6Rgiz4ODFAHATG0rFxw=" crossorigin="anonymous" title="mermaid"></script>
      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/bash.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/sql.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/http.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/javascript.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/json.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/markdown.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/xml.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/yaml.min.js"></script>
        
      

      
      
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.0e040a4c8b8532fc173c2fe4328906d0.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  
  <p class="powered-by">
    <a href="/license/">LICENSE: CC-BY-NC <br> <i class="fab fa-creative-commons fa-2x"></i><i class="fab fa-creative-commons-by fa-2x"></i><i class="fab fa-creative-commons-nc fa-2x"></i> </a><br>
  </p>
  

  <p class="powered-by">
    Qiushi Yan © 2020 &middot; 

    Made with the <a href="https://cran.r-project.org/" target="_blank" rel="noopener"><i class="fab fa-r-project"></i></a><a href="https://github.com/rstudio/blogdown" target="_blank" rel="noopener">blogdown</a> package, and the 
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>
  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
