<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.6.1">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Qiushi Yan">

  
  
  
    
  
  <meta name="description" content="A play with messy data in Hadley Wickham&#39;s tidy data paper in pandas">

  
  <link rel="alternate" hreflang="en-us" href="/post/2020-05-12-tidy-data-with-python/">

  


  
  
  
  <meta name="theme-color" content="#328cc1">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Arapey:400,400i%7CKarla:400,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-165703248-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           document.location = url;
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target);  
  }

  gtag('js', new Date());
  gtag('config', 'UA-165703248-1', {});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/2020-05-12-tidy-data-with-python/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@qiushizzzz">
  <meta property="twitter:creator" content="@qiushizzzz">
  
  <meta property="og:site_name" content="Qiushi Yan">
  <meta property="og:url" content="/post/2020-05-12-tidy-data-with-python/">
  <meta property="og:title" content="Tidy Data with Python | Qiushi Yan">
  <meta property="og:description" content="A play with messy data in Hadley Wickham&#39;s tidy data paper in pandas"><meta property="og:image" content="/img/icon-192.png">
  <meta property="twitter:image" content="/img/icon-192.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-05-12T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2020-05-12T22:11:05&#43;08:00">
  

  


    






  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/2020-05-12-tidy-data-with-python/"
  },
  "headline": "Tidy Data with Python",
  
  "datePublished": "2020-05-12T00:00:00Z",
  "dateModified": "2020-05-12T22:11:05+08:00",
  
  "author": {
    "@type": "Person",
    "name": "Qiushi Yan"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Qiushi Yan",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/icon-512.png"
    }
  },
  "description": "A play with messy data in Hadley Wickham's tidy data paper in pandas"
}
</script>

  

  


  


  





  <title>Tidy Data with Python | Qiushi Yan</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    
    
      <a class="navbar-brand" href="/">Qiushi Yan</a>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#post"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/about"><span>About / Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
      </li>
      

      

    </ul>

  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>Tidy Data with Python</h1>

  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    May 12, 2020
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    11 min read
  </span>
  

  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/python/">Python</a></span>
  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style">
      

<div id="TOC">
<ul>
<li><a href="#column-headers-are-values-not-variable-names">Column headers are values, not variable names</a></li>
<li><a href="#multiple-variables-stored-in-one-column">Multiple variables stored in one column</a></li>
<li><a href="#variables-are-stored-in-both-rows-and-columns">Variables are stored in both rows and columns</a></li>
<li><a href="#case-study-mortality-data-from-mexico">Case study: mortality data from Mexico</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

<p>This week I’ve been doing some recap on how to do basic data processing and cleaning in Python with the <code>pandas</code> and <code>NumPy</code> library. So this post is mostly a self-remainder on how to deal with messy data in Python, by reproducing data cleaning examples presented in Hadley Wickham’s <a href="https://vita.had.co.nz/papers/tidy-data.pdf">Tidy Data</a> paper, <span class="citation">Wickham (<a href="#ref-JSSv059i10" role="doc-biblioref">2014</a>)</span>.</p>
<p>The most significant contribution of this well-known work is that it gave clear definition on what “tidy” means for a dataset. There are 3 main requirements, as illustrated on <a href="https://tidyr.tidyverse.org/"><code>tidyr</code></a>’s website (evolving from what Hadley originally proposed):</p>
<ol style="list-style-type: decimal">
<li>Every column is a variable.</li>
<li>Every row is an observation.</li>
<li>Every cell is a single value.</li>
</ol>
<p>Messy data are, by extension, datasets in volation againest any of these 3 rules. The author then describes the five most common problems with messy datasets:</p>
<ul>
<li>Column headers are values, not variable names.</li>
<li>Multiple variables are stored in one column.<br />
</li>
<li>Variables are stored in both rows and columns.</li>
<li>Multiple types of observational units are stored in the same table.<br />
</li>
<li>A single observational unit is stored in multiple tables.</li>
</ul>
<p>In this post I will focusing on cleaning with the first 3 symptoms since the other two violations often occur when working with databases. All <a href="(https://github.com/chendaniely/scipy-2019-pandas/tree/master/data)">datasets</a> are from <a href="https://chendaniely.github.io/">Daniel Chen</a>’s 2019 SciPy talk on data manipulation with pandas.</p>
<pre class="python"><code>import numpy as np
import pandas as pd</code></pre>
<div id="column-headers-are-values-not-variable-names" class="section level1">
<h1>Column headers are values, not variable names</h1>
<pre class="python"><code>pew = pd.read_csv(&quot;D:/RProjects/data/blog/pew.csv&quot;)
pew.head()</code></pre>
<pre><code>#&gt;              religion  &lt;$10k  $10-20k  ...  $100-150k  &gt;150k  Don&#39;t know/refused
#&gt; 0            Agnostic     27       34  ...        109     84                  96
#&gt; 1             Atheist     12       27  ...         59     74                  76
#&gt; 2            Buddhist     27       21  ...         39     53                  54
#&gt; 3            Catholic    418      617  ...        792    633                1489
#&gt; 4  Don’t know/refused     15       14  ...         17     18                 116
#&gt; 
#&gt; [5 rows x 11 columns]</code></pre>
<p>The <code>pew</code> dataset explores the relationship between income and religion in the US, produced by the Pew ResearchCenter. To tidy it, we think of its “right” form for common data analysis questions, or what should be changed so that we could answer certain questions. Say, what if we want to a person’s income is influenced by his religion or the other way around. It should be obvious that we need to derive from <code>pew</code> a column to indicate the level of a person’s income, and another column being count of any combination of income and religion. <code>pew</code> is messy in the sense that all column names besides <code>religion</code>, from <code>&lt;$10k</code> to <code>Don't know/refused</code>, should be different levels (values) of a column storing information about income.</p>
<p>The code to this is fairly easy in pandas, the <code>.melt()</code> method is very similar to <code>tidyr::pivot_longer</code> and its namesake in the retired <code>reshape2</code> package.</p>
<pre class="python"><code>tidy_pew = pew.melt(id_vars = &quot;religion&quot;, var_name = &quot;income&quot;, value_name = &quot;count&quot;)
tidy_pew.head(20)</code></pre>
<pre><code>#&gt;                    religion   income  count
#&gt; 0                  Agnostic    &lt;$10k     27
#&gt; 1                   Atheist    &lt;$10k     12
#&gt; 2                  Buddhist    &lt;$10k     27
#&gt; 3                  Catholic    &lt;$10k    418
#&gt; 4        Don’t know/refused    &lt;$10k     15
#&gt; 5          Evangelical Prot    &lt;$10k    575
#&gt; 6                     Hindu    &lt;$10k      1
#&gt; 7   Historically Black Prot    &lt;$10k    228
#&gt; 8         Jehovah&#39;s Witness    &lt;$10k     20
#&gt; 9                    Jewish    &lt;$10k     19
#&gt; 10            Mainline Prot    &lt;$10k    289
#&gt; 11                   Mormon    &lt;$10k     29
#&gt; 12                   Muslim    &lt;$10k      6
#&gt; 13                 Orthodox    &lt;$10k     13
#&gt; 14          Other Christian    &lt;$10k      9
#&gt; 15             Other Faiths    &lt;$10k     20
#&gt; 16    Other World Religions    &lt;$10k      5
#&gt; 17             Unaffiliated    &lt;$10k    217
#&gt; 18                 Agnostic  $10-20k     34
#&gt; 19                  Atheist  $10-20k     27</code></pre>
<p>Now let’s calculate the <span class="math inline">\(\chi^2\)</span> statistic in R and the corresponding p value；</p>
<pre class="r"><code># R 
library(infer)
chisq_stat &lt;- py$tidy_pew %&gt;%
  tidyr::uncount(count) %&gt;% 
  specify(religion ~ income) %&gt;% 
  hypothesize(null = &quot;independence&quot;) %&gt;%
  calculate(stat = &quot;Chisq&quot;)

py$tidy_pew %&gt;%
  tidyr::uncount(count) %&gt;% 
  specify(religion ~ income) %&gt;% 
  hypothesize(null = &quot;independence&quot;) %&gt;%
  visualize(method = &quot;theoretical&quot;) +
  shade_p_value(obs_stat = chisq_stat, direction = &quot;both&quot;)</code></pre>
<p><img src="/post/2020-05-12-tidy-data-with-python/index_files/figure-html/unnamed-chunk-6-1.png" width="768" /></p>
<p>This shows strong relationship between <code>income</code> and <code>religion</code>.</p>
<p>Another common use of this wide data format is to record regularly spaced observations over time, illustrated by the <code>billboard</code> dataset. Ther rank of a specific track in each week after it enters the Billboard top 100 is recorded in 75 columns, <code>wk1</code> to <code>wk75</code>.</p>
<pre class="python"><code>billboard = pd.read_csv(&quot;D:/RProjects/data/blog/billboard.csv&quot;)
billboard</code></pre>
<pre><code>#&gt;      year            artist                    track  ... wk74 wk75  wk76
#&gt; 0    2000             2 Pac  Baby Don&#39;t Cry (Keep...  ...  NaN  NaN   NaN
#&gt; 1    2000           2Ge+her  The Hardest Part Of ...  ...  NaN  NaN   NaN
#&gt; 2    2000      3 Doors Down               Kryptonite  ...  NaN  NaN   NaN
#&gt; 3    2000      3 Doors Down                    Loser  ...  NaN  NaN   NaN
#&gt; 4    2000          504 Boyz            Wobble Wobble  ...  NaN  NaN   NaN
#&gt; ..    ...               ...                      ...  ...  ...  ...   ...
#&gt; 312  2000       Yankee Grey     Another Nine Minutes  ...  NaN  NaN   NaN
#&gt; 313  2000  Yearwood, Trisha          Real Live Woman  ...  NaN  NaN   NaN
#&gt; 314  2000   Ying Yang Twins  Whistle While You Tw...  ...  NaN  NaN   NaN
#&gt; 315  2000     Zombie Nation            Kernkraft 400  ...  NaN  NaN   NaN
#&gt; 316  2000   matchbox twenty                     Bent  ...  NaN  NaN   NaN
#&gt; 
#&gt; [317 rows x 81 columns]</code></pre>
<p>If we are to answer questions like “what are the average ranking of artisits across all weeks?”, <code>wk</code> columns need to be transformed into values:</p>
<pre class="python"><code>tidy_billboard = billboard.melt(id_vars = [&quot;year&quot;, &quot;artist&quot;, &quot;track&quot;, &quot;time&quot;, &quot;date.entered&quot;],
                                var_name = &quot;week&quot;,
                                value_name = &quot;rank&quot;)
                                
tidy_billboard</code></pre>
<pre><code>#&gt;        year            artist                    track  ... date.entered  week  rank
#&gt; 0      2000             2 Pac  Baby Don&#39;t Cry (Keep...  ...   2000-02-26   wk1  87.0
#&gt; 1      2000           2Ge+her  The Hardest Part Of ...  ...   2000-09-02   wk1  91.0
#&gt; 2      2000      3 Doors Down               Kryptonite  ...   2000-04-08   wk1  81.0
#&gt; 3      2000      3 Doors Down                    Loser  ...   2000-10-21   wk1  76.0
#&gt; 4      2000          504 Boyz            Wobble Wobble  ...   2000-04-15   wk1  57.0
#&gt; ...     ...               ...                      ...  ...          ...   ...   ...
#&gt; 24087  2000       Yankee Grey     Another Nine Minutes  ...   2000-04-29  wk76   NaN
#&gt; 24088  2000  Yearwood, Trisha          Real Live Woman  ...   2000-04-01  wk76   NaN
#&gt; 24089  2000   Ying Yang Twins  Whistle While You Tw...  ...   2000-03-18  wk76   NaN
#&gt; 24090  2000     Zombie Nation            Kernkraft 400  ...   2000-09-02  wk76   NaN
#&gt; 24091  2000   matchbox twenty                     Bent  ...   2000-04-29  wk76   NaN
#&gt; 
#&gt; [24092 rows x 7 columns]</code></pre>
<p>Now we can compute the average ranking:</p>
<pre class="python"><code>(tidy_billboard.
  groupby(&quot;artist&quot;)[[&quot;rank&quot;]].
  mean().
  sort_values(by = &quot;rank&quot;)
)</code></pre>
<pre><code>#&gt;                                    rank
#&gt; artist                                 
#&gt; Santana                       10.500000
#&gt; Elliott, Missy &quot;Misdemeanor&quot;  14.333333
#&gt; matchbox twenty               18.641026
#&gt; N&#39;Sync                        18.648649
#&gt; Janet                         19.416667
#&gt; ...                                 ...
#&gt; Lil&#39; Mo                       98.142857
#&gt; LL Cool J                     98.500000
#&gt; Zombie Nation                 99.000000
#&gt; Fragma                        99.000000
#&gt; Smith, Will                   99.000000
#&gt; 
#&gt; [228 rows x 1 columns]</code></pre>
</div>
<div id="multiple-variables-stored-in-one-column" class="section level1">
<h1>Multiple variables stored in one column</h1>
<blockquote>
<p>The <code>tb</code> daaset comes from the World Health Organisation, and records the counts of confirmed tuberculosis cases bycountry,year, and demographic group. The demographic groups are broken down by sex (m, f) and age(0–14, 15–25, 25–34, 35–44.</p>
</blockquote>
<pre class="python"><code>tb = pd.read_csv(&quot;D:/RProjects/data/blog/tb.csv&quot;)
tb</code></pre>
<pre><code>#&gt;     country  year   m014   m1524   m2534  ...   f3544  f4554  f5564   f65  fu
#&gt; 0        AD  2000    0.0     0.0     1.0  ...     NaN    NaN    NaN   NaN NaN
#&gt; 1        AE  2000    2.0     4.0     4.0  ...     3.0    0.0    0.0   4.0 NaN
#&gt; 2        AF  2000   52.0   228.0   183.0  ...   339.0  205.0   99.0  36.0 NaN
#&gt; 3        AG  2000    0.0     0.0     0.0  ...     0.0    0.0    0.0   0.0 NaN
#&gt; 4        AL  2000    2.0    19.0    21.0  ...     8.0    8.0    5.0  11.0 NaN
#&gt; ..      ...   ...    ...     ...     ...  ...     ...    ...    ...   ...  ..
#&gt; 196      YE  2000  110.0   789.0   689.0  ...   517.0  345.0  247.0  92.0 NaN
#&gt; 197      YU  2000    NaN     NaN     NaN  ...     NaN    NaN    NaN   NaN NaN
#&gt; 198      ZA  2000  116.0   723.0  1999.0  ...   933.0  423.0  167.0  80.0 NaN
#&gt; 199      ZM  2000  349.0  2175.0  2610.0  ...  1305.0  186.0  112.0  75.0 NaN
#&gt; 200      ZW  2000    NaN     NaN     NaN  ...     NaN    NaN    NaN   NaN NaN
#&gt; 
#&gt; [201 rows x 18 columns]</code></pre>
<p>To clean the this data, we first melt all columns except for <code>country</code> and <code>year</code> in return for a longer version of <code>tb</code>, and then seperate the <code>variable</code> column into two pieces of information, <code>sex</code> and <code>age</code>.</p>
<pre class="python"><code>tb_long = tb.melt(id_vars = [&quot;country&quot;, &quot;year&quot;])
sex = tb_long[&quot;variable&quot;].str.split(pat = &quot;(m|f)(.+)&quot;).str.get(1)
age = tb_long[&quot;variable&quot;].str.split(pat = &quot;(m|f)(.+)&quot;).str.get(2)

print(sex)</code></pre>
<pre><code>#&gt; 0       m
#&gt; 1       m
#&gt; 2       m
#&gt; 3       m
#&gt; 4       m
#&gt;        ..
#&gt; 3211    f
#&gt; 3212    f
#&gt; 3213    f
#&gt; 3214    f
#&gt; 3215    f
#&gt; Name: variable, Length: 3216, dtype: object</code></pre>
<pre class="python"><code>print(age)</code></pre>
<pre><code>#&gt; 0       014
#&gt; 1       014
#&gt; 2       014
#&gt; 3       014
#&gt; 4       014
#&gt;        ... 
#&gt; 3211      u
#&gt; 3212      u
#&gt; 3213      u
#&gt; 3214      u
#&gt; 3215      u
#&gt; Name: variable, Length: 3216, dtype: object</code></pre>
<p>Add these two columns and drop the redundant <code>variable</code> column</p>
<pre class="python"><code>tidy_tb = tb_long.assign(sex = sex, age = age).drop(&quot;variable&quot;, axis = 1)
tidy_tb</code></pre>
<pre><code>#&gt;      country  year  value sex  age
#&gt; 0         AD  2000    0.0   m  014
#&gt; 1         AE  2000    2.0   m  014
#&gt; 2         AF  2000   52.0   m  014
#&gt; 3         AG  2000    0.0   m  014
#&gt; 4         AL  2000    2.0   m  014
#&gt; ...      ...   ...    ...  ..  ...
#&gt; 3211      YE  2000    NaN   f    u
#&gt; 3212      YU  2000    NaN   f    u
#&gt; 3213      ZA  2000    NaN   f    u
#&gt; 3214      ZM  2000    NaN   f    u
#&gt; 3215      ZW  2000    NaN   f    u
#&gt; 
#&gt; [3216 rows x 5 columns]</code></pre>
</div>
<div id="variables-are-stored-in-both-rows-and-columns" class="section level1">
<h1>Variables are stored in both rows and columns</h1>
<blockquote>
<p>The <code>weather</code> data shows daily weather data from the Global Historical Climatology Networkfor one weather station (MX17004) in Mexico for five months in 2010.</p>
</blockquote>
<pre class="python"><code>weather = pd.read_csv(&quot;D:/RProjects/data/blog/weather.csv&quot;)
weather</code></pre>
<pre><code>#&gt;          id  year  month element    d1  ...   d27   d28   d29   d30   d31
#&gt; 0   MX17004  2010      1    tmax   NaN  ...   NaN   NaN   NaN  27.8   NaN
#&gt; 1   MX17004  2010      1    tmin   NaN  ...   NaN   NaN   NaN  14.5   NaN
#&gt; 2   MX17004  2010      2    tmax   NaN  ...   NaN   NaN   NaN   NaN   NaN
#&gt; 3   MX17004  2010      2    tmin   NaN  ...   NaN   NaN   NaN   NaN   NaN
#&gt; 4   MX17004  2010      3    tmax   NaN  ...   NaN   NaN   NaN   NaN   NaN
#&gt; 5   MX17004  2010      3    tmin   NaN  ...   NaN   NaN   NaN   NaN   NaN
#&gt; 6   MX17004  2010      4    tmax   NaN  ...  36.3   NaN   NaN   NaN   NaN
#&gt; 7   MX17004  2010      4    tmin   NaN  ...  16.7   NaN   NaN   NaN   NaN
#&gt; 8   MX17004  2010      5    tmax   NaN  ...  33.2   NaN   NaN   NaN   NaN
#&gt; 9   MX17004  2010      5    tmin   NaN  ...  18.2   NaN   NaN   NaN   NaN
#&gt; 10  MX17004  2010      6    tmax   NaN  ...   NaN   NaN  30.1   NaN   NaN
#&gt; 11  MX17004  2010      6    tmin   NaN  ...   NaN   NaN  18.0   NaN   NaN
#&gt; 12  MX17004  2010      7    tmax   NaN  ...   NaN   NaN   NaN   NaN   NaN
#&gt; 13  MX17004  2010      7    tmin   NaN  ...   NaN   NaN   NaN   NaN   NaN
#&gt; 14  MX17004  2010      8    tmax   NaN  ...   NaN   NaN  28.0   NaN  25.4
#&gt; 15  MX17004  2010      8    tmin   NaN  ...   NaN   NaN  15.3   NaN  15.4
#&gt; 16  MX17004  2010     10    tmax   NaN  ...   NaN  31.2   NaN   NaN   NaN
#&gt; 17  MX17004  2010     10    tmin   NaN  ...   NaN  15.0   NaN   NaN   NaN
#&gt; 18  MX17004  2010     11    tmax   NaN  ...  27.7   NaN   NaN   NaN   NaN
#&gt; 19  MX17004  2010     11    tmin   NaN  ...  14.2   NaN   NaN   NaN   NaN
#&gt; 20  MX17004  2010     12    tmax  29.9  ...   NaN   NaN   NaN   NaN   NaN
#&gt; 21  MX17004  2010     12    tmin  13.8  ...   NaN   NaN   NaN   NaN   NaN
#&gt; 
#&gt; [22 rows x 35 columns]</code></pre>
<p>There are two tasks for cleaning this data:</p>
<ul>
<li><code>d1</code>, <code>d2</code>, …, <code>d31</code> should be values instead of column names (solved by <code>.melt</code>)</li>
<li>Reversely, values in the <code>element</code> column should be column names, it should be spread into two columns <code>tmax</code>, <code>tmin</code> (solved by <code>.pivot_table</code>)</li>
</ul>
<pre class="python"><code>(weather.
  melt(id_vars = [&quot;id&quot;, &quot;year&quot;, &quot;month&quot;, &quot;element&quot;], var_name = &quot;day&quot;, value_name = &quot;temp&quot;).
  pivot_table(index = [&quot;id&quot;, &quot;year&quot;, &quot;month&quot;, &quot;day&quot;],
              columns = &quot;element&quot;,
              values = &quot;temp&quot;).
  reset_index().
  head()
)</code></pre>
<pre><code>#&gt; element       id  year  month  day  tmax  tmin
#&gt; 0        MX17004  2010      1  d30  27.8  14.5
#&gt; 1        MX17004  2010      2  d11  29.7  13.4
#&gt; 2        MX17004  2010      2   d2  27.3  14.4
#&gt; 3        MX17004  2010      2  d23  29.9  10.7
#&gt; 4        MX17004  2010      2   d3  24.1  14.4</code></pre>
</div>
<div id="case-study-mortality-data-from-mexico" class="section level1">
<h1>Case study: mortality data from Mexico</h1>
<p>After stating these common problems and their remidies, Hadley presented a case study section on how tidy dataset can facilitate data analysis.</p>
<pre class="python"><code>deaths = pd.read_csv(&quot;D:/RProjects/data/blog/mexico-deaths.csv&quot;)
deaths</code></pre>
<pre><code>#&gt;          yod  mod  dod  hod  cod
#&gt; 0          0    0    0  NaN  E14
#&gt; 1          0    0    0  NaN  E46
#&gt; 2          0    0    0  NaN  I21
#&gt; 3          0    0    0  NaN  K70
#&gt; 4          0    0    0  NaN  P21
#&gt; ...      ...  ...  ...  ...  ...
#&gt; 539525  2008   12   31  NaN  W84
#&gt; 539526  2008   12   31  NaN  X00
#&gt; 539527  2008   12   31  NaN  X59
#&gt; 539528  2008   12   31  NaN  X99
#&gt; 539529  2008   12   31  NaN  X99
#&gt; 
#&gt; [539530 rows x 5 columns]</code></pre>
<pre class="python"><code>deaths.isnull().sum()</code></pre>
<pre><code>#&gt; yod        0
#&gt; mod        0
#&gt; dod        0
#&gt; hod    26257
#&gt; cod        0
#&gt; dtype: int64</code></pre>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-JSSv059i10">
<p>Wickham, Hadley. 2014. “Tidy Data.” <em>Journal of Statistical Software, Articles</em> 59 (10): 1–23. <a href="https://doi.org/10.18637/jss.v059.i10">https://doi.org/10.18637/jss.v059.i10</a>.</p>
</div>
</div>
</div>

    </div>

    







<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/2020-05-12-tidy-data-with-python/&amp;text=Tidy%20Data%20with%20Python" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/2020-05-12-tidy-data-with-python/&amp;t=Tidy%20Data%20with%20Python" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Tidy%20Data%20with%20Python&amp;body=/post/2020-05-12-tidy-data-with-python/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/2020-05-12-tidy-data-with-python/&amp;title=Tidy%20Data%20with%20Python" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Tidy%20Data%20with%20Python%20/post/2020-05-12-tidy-data-with-python/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/2020-05-12-tidy-data-with-python/&amp;title=Tidy%20Data%20with%20Python" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  






  
  
  
    
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="portrait mr-3" src="/authors/qiushi/avatar_hu2833603c9957d65d4c6e6cf5762ee973_72134_250x250_fill_q90_lanczos_center.jpg" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Qiushi Yan</a></h5>
      <h6 class="card-subtitle">Junior student, Data Journalism</h6>
      <p class="card-text">Yet another object of type closure</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/enixam" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/qiushizzzz" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/%E6%B1%82%E8%AF%86-%E9%97%AB-893a48194/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/about" >
        <i class="fas fa-address-card"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>




<section id="comments">
  
    
<div id="disqus_thread"></div>
<script>
  let disqus_config = function () {
    
    
    
  };
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
      return;
    }
    var d = document, s = d.createElement('script'); s.async = true;
    s.src = 'https://' + "qiushiyan" + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  
</section>




<div class="article-widget">
  
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/post/classification-metrics/" rel="prev">A Manual of Classification Metrics</a>
  </div>
  
</div>

</div>



  
  



  </div>
</article>

      

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.3.1/mermaid.min.js" integrity="sha256-vOIuDSYDirTfyr+S2MjFnhOz6Rgiz4ODFAHATG0rFxw=" crossorigin="anonymous" title="mermaid"></script>
      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/bash.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/sql.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/http.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/javascript.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/json.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/markdown.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/xml.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/yaml.min.js"></script>
        
      

      
      
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.0e040a4c8b8532fc173c2fe4328906d0.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  
  <p class="powered-by">
    <a href="/license/">LICENSE: CC-BY-NC <br> <i class="fab fa-creative-commons fa-2x"></i><i class="fab fa-creative-commons-by fa-2x"></i><i class="fab fa-creative-commons-nc fa-2x"></i> </a><br>
  </p>
  

  <p class="powered-by">
    Qiushi Yan © 2020 &middot; 

    Made with the <a href="https://cran.r-project.org/" target="_blank" rel="noopener"><i class="fab fa-r-project"></i></a><a href="https://github.com/rstudio/blogdown" target="_blank" rel="noopener">blogdown</a> package, and the 
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>
  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
